#!/bin/sh
# https://github.com/dxlr8r/kubefs
if test ${UID:--1} -eq 0; then
  : ${KUBEFS_LIBEXEC_DIR:="/usr/libexec/kubefs"}
  : ${KUBEFS_PROFILE_DIR:="/etc/profile.d"}
else
  : ${KUBEFS_LIBEXEC_DIR:="$HOME/.local/libexec/kubefs"}
  : ${KUBEFS_PROFILE_DIR:="$HOME/.local/profile.d"}
fi
mkdir -p "$KUBEFS_LIBEXEC_DIR" "$KUBEFS_PROFILE_DIR"
printf '%s\n' 'IyEvYmluL3NoCiMgaHR0cHM6Ly9naXRodWIuY29tL2R4bHI4ci9rdWJlZnMKCkt1YmVGcygpIHsKY2FzZSAiJHsxOi1nZXR9IiBpbgoKIyBLdWJlRnMgZnVuY3Rpb25zCiMgPT09PT09PT09PT09PT09PQoKZm4pIHNoaWZ0CmNhc2UgIiQxIiBpbgprdWJlZnMtYmFzaC1jb21wbGV0ZSkKY2F0IDw8ICdFT0YnCiMga3ViZWZzIGNvbXBsZXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSotIHNoZWxsLXNjcmlwdCAtKi0KCiMgVGhpcyBiYXNoIGNvbXBsZXRpb25zIHNjcmlwdCB3YXMgZ2VuZXJhdGVkIGJ5CiMgY29tcGxldGVseSAoaHR0cHM6Ly9naXRodWIuY29tL2Rhbm55YmVuL2NvbXBsZXRlbHkpCiMgTW9kaWZ5aW5nIGl0IG1hbnVhbGx5IGlzIG5vdCByZWNvbW1lbmRlZAoKX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIoKSB7CiAgbG9jYWwgd29yZHM9IiQxIgogIGxvY2FsIGN1cj0ke0NPTVBfV09SRFNbQ09NUF9DV09SRF19CiAgbG9jYWwgcmVzdWx0PSgpCgogIGlmIFtbICIke2N1cjowOjF9IiA9PSAiLSIgXV07IHRoZW4KICAgIGVjaG8gIiR3b3JkcyIKCiAgZWxzZQogICAgZm9yIHdvcmQgaW4gJHdvcmRzOyBkbwogICAgICBbWyAiJHt3b3JkOjA6MX0iICE9ICItIiBdXSAmJiByZXN1bHQrPSgiJHdvcmQiKQogICAgZG9uZQoKICAgIGVjaG8gIiR7cmVzdWx0WypdfSIKCiAgZmkKfQoKX2t1YmVmc19jb21wbGV0aW9ucygpIHsKICBsb2NhbCBjdXI9JHtDT01QX1dPUkRTW0NPTVBfQ1dPUkRdfQogIGxvY2FsIGNvbXB3b3Jkcz0oIiR7Q09NUF9XT1JEU1tAXToxOiRDT01QX0NXT1JELTF9IikKICBsb2NhbCBjb21wbGluZT0iJHtjb21wd29yZHNbKl19IgoKICBjYXNlICIkY29tcGxpbmUiIGluCiAgICAnbG9jayBzZXNzaW9uIHRvZ2dsZScqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiQoZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWNvbmZpZycgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydCkiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCB0b2dnbGUnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIkKGZpbmQgIiR7S1VCRUZTX1JPT1Q6LSRIT01FLy5rdWJlfSIgLXR5cGUgZiAtbmFtZSAnLmt1YmVjb25maWcnIDI+L2Rldi9udWxsIHwgTENfQ09MTEFURT1DLlVURi04IHNvcnQpIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAnbG9jayBzZXNzaW9uIGxpc3QnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCBsaXN0JyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAiIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAnbG9jayBzZXNzaW9uIHNldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiQoZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWNvbmZpZycgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydCkiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIHNlc3Npb24gZGVsJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAiIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAnbG9jayBzZXNzaW9uIGdldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xvY2sgZ2xvYmFsIHNldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiQoZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWNvbmZpZycgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydCkiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCBkZWwnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCBnZXQnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIHNlc3Npb24nKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICJzZXQgdG9nZ2xlIGRlbCBnZXQgbGlzdCIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xvY2sgZ2xvYmFsJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAic2V0IHRvZ2dsZSBkZWwgZ2V0IGxpc3QiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsaXN0LWFsbCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xpc3QnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdmaW5kJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAia3ViZWF1dGgga3ViZWNvbmZpZyIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2F1dGgnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIkKGZpbmQgIiR7S1VCRUZTX1JPT1Q6LSRIT01FLy5rdWJlfSIgLXR5cGUgZiAtbmFtZSAnLmt1YmVhdXRoJyAyPi9kZXYvbnVsbCB8IExDX0NPTExBVEU9Qy5VVEYtOCBzb3J0KSIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xvY2snKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICJnbG9iYWwgc2Vzc2lvbiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2dldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2NkJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAiJChmaW5kICIke0tVQkVGU19ST09UOi0kSE9NRS8ua3ViZX0iIC10eXBlIGYgLW5hbWUgJy5rdWJlY29uZmlnJyAtZXhlYyBkaXJuYW1lIHt9IFw7IDI+L2Rldi9udWxsIHwgTENfQ09MTEFURT1DLlVURi04IHNvcnQpIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgImdldCBsaXN0IGxpc3QtYWxsIGZpbmQgY2QgYXV0aCBsb2NrIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgZXNhYwp9ICYmCiAgY29tcGxldGUgLW8gbm9zb3J0IC1GIF9rdWJlZnNfY29tcGxldGlvbnMga3ViZWZzCgojIGV4OiBmaWxldHlwZT1zaAoKRU9GCjs7CnByaW50Zi1zdGRlcnIpIHNoaWZ0CiAgaWYgdGVzdCAkIyAtZXEgMDsgdGhlbgogICAgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIgJyVzXG4nICIkKGNhdCkiCiAgZWxzZQogICAgcHJpbnRmIC0tICIkQCIgPi9kZXYvc3RkZXJyCiAgZmkKOzsKCmlwcmludGYpIHNoaWZ0CiAgaWYgY2FzZSAiJHstOi19IiBpbiAqaSopIHRydWU7OyAqKSBmYWxzZTs7IGVzYWMgfHwgdGVzdCAiJHtLVUJFRlNfREVCVUc6LWZhbHNlfSIgPSAndHJ1ZSc7IHRoZW4KICAgIGlmIHRlc3QgJCMgLWVxIDA7IHRoZW4KICAgICAgY2F0IHwgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIKICAgIGVsc2UKICAgICAgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIgIiRAIgogICAgZmkKICBmaQo7OwoKZGVidWcpIHNoaWZ0CiAgaWYgdGVzdCAiJHtLVUJFRlNfREVCVUc6LWZhbHNlfSIgPSAndHJ1ZSc7IHRoZW4KICAgIGlmIHRlc3QgJCMgLWVxIDA7IHRoZW4KICAgICAgY2F0IHwgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIKICAgIGVsc2UKICAgICAgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIgIiRAIgogICAgZmkKICBmaQo7OwoKZGVzY2VuZGFudHMpIHNoaWZ0OyAoCiAgdGVzdCAtbiAiJHsxOi19IiB8fCByZXR1cm4gMQogIGlmIHRlc3QgIiQxIiAhPSAnLyc7IHRoZW4KICAgIHByaW50ZiAnJXNcbicgIiQxIgogICAgS3ViZUZzIGZuIGRlc2NlbmRhbnRzICIkKGRpcm5hbWUgIiQxIikiCiAgZWxzZQogICAgcHJpbnRmICcvXG4nCiAgICByZXR1cm4gMAogIGZpCikKOzsKCmRpcm5hbWUpIHNoaWZ0OyAoCiAgaWYgdGVzdCAtZCAiJHsxOi19IjsgdGhlbgogICAgIyBwcmludGYgJyVzXG4nICIkMSIKICAgIGNkICIkMSI7IHB3ZAogIGVsaWYgdGVzdCAtZSAiJHsxOi19IjsgdGhlbgogICAgY2QgIiQoZGlybmFtZSAiJDEiKSI7IHB3ZAogIGVsc2UKICAgIDoKICBmaQopCjs7CgpyZXNvbHZlLXN5bWxpbmspIHNoaWZ0CiAgYXdrIFwKICAtdiBMSU5LPSIkMSIgXAogIC12IExJU1Q9IiQoTENfQUxMPUMgY29tbWFuZCBscyAtbCAiJDEiKSIgXAogICdCRUdJTiB7CiAgICBMSU5LX0xFTj1sZW5ndGgoTElOSykKICAgIExJTktfUE9TPWluZGV4KExJU1QsIExJTkspOwogICAgcHJpbnQgc3Vic3RyKExJU1QsIExJTktfUE9TK0xJTktfTEVOKzQpCiAgfScKOzsKCmZpbmQta3ViZWZpbGUpIHNoaWZ0OyAoCiAgc2V0IC0tICIkKEt1YmVGcyBmbiBkaXJuYW1lICIkezE6LX0iKSIgIiR7MjotLmt1YmVjb25maWd9IgogICMgZmluZCBmaXJzdCBvY2N1cmVuY2Ugb2YgLmt1YmVjb25maWcgaW4gdGhlIHBhcmVudCB0cmVlCiAga3ViZWZpbGU9JChcCiAgICBLdWJlRnMgZm4gZGVzY2VuZGFudHMgIiQxIiBcCiAgICB8IHhhcmdzIC1JIHt9IGxzIC0xIHt9LyQyIDI+L2Rldi9udWxsIFwKICAgIHwgaGVhZCAtbjEgXAogICkKICBLdWJlRnMgZm4gZGVidWcgJyMgS1VCRUZJTEU9IiVzIlxuJyAiJGt1YmVmaWxlIgogIHRlc3QgLXogIiRrdWJlZmlsZSIgfHwgcHJpbnRmICclc1xuJyAiJGt1YmVmaWxlIgopCjs7CgpmaW5kLWFueS1rdWJlY29uZmlnKSBzaGlmdDsgKAogIGlmCiAgICBrdWJlY29uZmlnPSQoS3ViZUZzIGZuIGZpbmQta3ViZWZpbGUgIiR7MTotfSIpCiAgICB0ZXN0IC1uICIka3ViZWNvbmZpZyIKICB0aGVuCiAgICA6CiAgZWxpZiB0ZXN0IC1uICIke0xPQ0tfS1VCRUNPTkZJRzotfSI7IHRoZW4KICAgIGt1YmVjb25maWc9IiRMT0NLX0tVQkVDT05GSUciCiAgZWxzZQogICAga3ViZWNvbmZpZz0iJEhPTUUvLmt1YmUvY29uZmlnIgogIGZpCgogIEt1YmVGcyBmbiBkZWJ1ZyAnIyBLVUJFQ09ORklHPSIlcyJcbicgIiRrdWJlY29uZmlnIgogIHByaW50ZiAnJXNcbicgIiRrdWJlY29uZmlnIgopCjs7Cgpsb2NrLXNlc3Npb24tc2V0KSBzaGlmdAogIHNldCAtLSAiJChLdWJlRnMgZm4gZmluZC1rdWJlZmlsZSAiJHsxOi0ufSIpIgogIGlmIHRlc3QgLXogIiR7MTotfSI7IHRoZW4KICAgIEt1YmVGcyBmbiBwcmludGYtc3RkZXJyICcjIElORk86IG5vIGAua3ViZWNvbmZpZ2AgZm91bmQgaW4gZGlyZWN0b3J5IGAlc2AuXG4nICIkKHB3ZCkiCiAgICByZXR1cm4gMQogIGVsc2UKICAgIGV4cG9ydCBMT0NLX0tVQkVDT05GSUc9JDEKICAgIGV4cG9ydCBLVUJFQ09ORklHPSRMT0NLX0tVQkVDT05GSUcKICAgIEt1YmVGcyBmbiBpcHJpbnRmICcjIExPQ0tfS1VCRUNPTkZJRz0iJXMiXG4nICIkTE9DS19LVUJFQ09ORklHIgogIGZpCjs7CmxvY2stc2Vzc2lvbi1kZWwpIHNoaWZ0CiAgdGVzdCAiJHtLVUJFQ09ORklHOi19IiA9ICIke0xPQ0tfS1VCRUNPTkZJRzotfSIgJiYgdW5zZXQgS1VCRUNPTkZJRyB8fCA6CiAgdW5zZXQgTE9DS19LVUJFQ09ORklHCiAgS3ViZUZzIGZuIGlwcmludGYgJyMgdW5zZXQgTE9DS19LVUJFQ09ORklHXG4nCjs7CmxvY2stc2Vzc2lvbi10b2dnbGUpIHNoaWZ0CiAgaWYgdGVzdCAteiAiJHsxOi19IiAtYSAtbiAiJExPQ0tfS1VCRUNPTkZJRyI7IHRoZW4KICAgIEt1YmVGcyBmbiBsb2NrLXNlc3Npb24tZGVsCiAgZWxzZQogICAgS3ViZUZzIGZuIGxvY2stc2Vzc2lvbi1zZXQgIiR7MTotfSIKICBmaQo7Owpsb2NrLXNlc3Npb24tZ2V0KSBzaGlmdDsgKAogIGlmIHRlc3QgLW4gIiRMT0NLX0tVQkVDT05GSUciOyB0aGVuCiAgICB0ZXN0ICIkezE6LX0iID0gImxpc3QiIFwKICAgICYmIHByaW50ZiAnTE9DS19LVUJFQ09ORklHPSIlcyJcbicgIiQoS3ViZUZzIGZuIGxvY2stc2Vzc2lvbi1nZXQpIiBcCiAgICB8fCBwcmludGYgJyVzXG4nICIkTE9DS19LVUJFQ09ORklHIgogIGZpCikKOzsKCmxvY2stZ2xvYmFsLXNldCkgc2hpZnQ7ICgKICBzZXQgLS0gIiQoS3ViZUZzIGZuIGZpbmQta3ViZWZpbGUgIiR7MTotLn0iKSIKICBpZiB0ZXN0IC16ICIkezE6LX0iOyB0aGVuCiAgICBLdWJlRnMgZm4gcHJpbnRmLXN0ZGVyciAnIyBJTkZPOiBubyBgLmt1YmVjb25maWdgIGZvdW5kIGluIGRpcmVjdG9yeSBgJXNgLlxuJyAiJChwd2QpIgogICAgcmV0dXJuIDEKICBlbHNlCiAgICB0ZXN0IC1MICIkSE9NRS8ua3ViZS9jb25maWciICYmIHVubGluayAiJEhPTUUvLmt1YmUvY29uZmlnIiB8fCA6CiAgICBpZiAhIHRlc3QgLWUgIiRIT01FLy5rdWJlL2NvbmZpZyI7IHRoZW4KICAgICAgbG4gLXMgIiQxIiAiJEhPTUUvLmt1YmUvY29uZmlnIgogICAgICBLdWJlRnMgZm4gaXByaW50ZiAnIyBsbiAtcyAiJXMiICIlcyJcbicgIiQxIiAiJEhPTUUvLmt1YmUvY29uZmlnIgogICAgZWxzZQogICAgICBLdWJlRnMgZm4gcHJpbnRmLXN0ZGVyciAnIyBFUlJPUjogYCVzYCBub3QgYSBzeW1saW5rLlxuJyAiJEhPTUUvLmt1YmUvY29uZmlnIgogICAgZmkKICBmaQopCjs7CmxvY2stZ2xvYmFsLWRlbCkgc2hpZnQ7ICgKICBpZiB1bmxpbmsgIiRIT01FLy5rdWJlL2NvbmZpZyIgMj4vZGV2L251bGw7IHRoZW4KICAgIEt1YmVGcyBmbiBpcHJpbnRmICcjIHVubGluayAiJXMiXG4nICIkSE9NRS8ua3ViZS9jb25maWciCiAgZWxzZQogICAgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIgJyMgV0FSTklORzogYCVzYCBub3QgYSBzeW1saW5rLlxuJyAiJEhPTUUvLmt1YmUvY29uZmlnIgogIGZpCikKOzsKbG9jay1nbG9iYWwtdG9nZ2xlKSBzaGlmdDsgKAogIGlmIHRlc3QgLXogIiR7MTotfSIgLWEgLUwgIiRIT01FLy5rdWJlL2NvbmZpZyI7IHRoZW4KICAgIEt1YmVGcyBmbiBsb2NrLWdsb2JhbC1kZWwKICBlbHNlCiAgICBLdWJlRnMgZm4gbG9jay1nbG9iYWwtc2V0ICIkezE6LX0iCiAgZmkKKQo7Owpsb2NrLWdsb2JhbC1nZXQpIHNoaWZ0OyAoCiAgaWYgdGVzdCAtTCAiJEhPTUUvLmt1YmUvY29uZmlnIjsgdGhlbgogICAgdGVzdCAiJHsxOi19IiA9ICJsaXN0IiAmJiBwcmludGYgJyVzIC0+ICcgIiRIT01FLy5rdWJlL2NvbmZpZyIgfHwgOgogICAgcHJpbnRmICclc1xuJyAiJChLdWJlRnMgZm4gcmVzb2x2ZS1zeW1saW5rICIkSE9NRS8ua3ViZS9jb25maWciKSIKICBmaQopCjs7CgprdWJlYXV0aCkgc2hpZnQKICBpZiB0ZXN0IC16ICIkezE6LX0iIC1hIC1uICIke0xPQ0tfS1VCRUNPTkZJRzotfSI7IHRoZW4KICAgIEt1YmVGcyBmbiBwcmludGYtc3RkZXJyICcjIElORk86IGBMT0NLX0tVQkVDT05GSUdgIGlzIHNldCwgYXR0ZW1wdGluZyB0byBkZWR1Y3QgYC5rdWJlYXV0aGAuXG4nCiAgICBzZXQgLS0gIiQoS3ViZUZzIGZuIGZpbmQta3ViZWZpbGUgIiRMT0NLX0tVQkVDT05GSUciICcua3ViZWF1dGgnKSIgXwogIGVsc2UKICAgIHNldCAtLSAiJChLdWJlRnMgZm4gZmluZC1rdWJlZmlsZSAiJHsxOi0ufSIgJy5rdWJlYXV0aCcpIgogIGZpCgogIGlmIHRlc3QgLXogIiQxIjsgdGhlbgogICAgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIgIiMgV0FSTklORzogQ291bGQgbm90IGZpbmQgYW55IFxgLmt1YmVhdXRoXGAgaW4gcGF0aCBvciBkZXNjZW5kYW50cycgcGF0aHMuXG4iCiAgICByZXR1cm4gMQogIGZpCgogIHRlc3QgLXggIiQxIiB8fCBjaG1vZCAreCAiJDEiCiAgS3ViZUZzIGZuIGRlYnVnICcjIGt1YmVhdXRoPSIlcyJcbicgIiQxIgogICIkMSIKCiAgIyBsb2NrIHNlc3Npb24gdW5sZXNzIGlzIGFscmVhZHkgY3VycmVudCBsb2NrCiAgaWYKICAgIHRlc3QgIiR7S1VCRUZTX0FVVEhfU0VTU0lPTl9MT0NLOi1mYWxzZX0iID0gJ3RydWUnICYmCiAgICB0ZXN0ICIke0xPQ0tfS1VCRUNPTkZJRzotfSIgIT0gIiQxIi8ua3ViZWNvbmZpZwogIHRoZW4KICAgIEt1YmVGcyBmbiBsb2NrLXNlc3Npb24tc2V0ICIkMSIKICBmaQoKICBpZgogICAgdGVzdCAiJHtLVUJFRlNfQVVUSF9BVVRPX0NEOi1mYWxzZX0iID0gJ3RydWUnICYmCiAgICB0ZXN0IC1uICIkezI6LX0iCiAgdGhlbgogICAgS3ViZUZzIGZuIGNkICIkKGRpcm5hbWUgIiR7MTotfSIpIgogIGZpCgogICMgYWxsb3cgZm9yIC5rdWJlYXV0aCBhbmQgLmt1YmVjb25maWcgdG8gbm90IGJlIGluIHRoZSBzYW1lIGRpcmVjdG9yeSwgYmVzaWRlcyBLVUJFRlNfQ0RfU0VTU0lPTl9MT0NLIGRvZXMgdGhlIHNhbWUKICAjIHRlc3QgLXogIiR7MjotfSIgfHwgS3ViZUZzIGZuIGxvY2stc2Vzc2lvbi1zZXQgIiQxIgo7OwoKa3ViZWN0bCkgc2hpZnQ7ICgKICBleHBvcnQgS1VCRUNPTkZJRz0kKEt1YmVGcyBmbiBmaW5kLWFueS1rdWJlY29uZmlnKQogIGNvbW1hbmQga3ViZWN0bCAiJEAiCikKOzsKCmNkKSBzaGlmdAogICMgaWYgbm8gYXJndW1lbnQsIHNldCAkMSB0byBzZXNzaW9uIG9yIGdsb2JhbCBsb2NrIChpZiBzZXQpCiAgaWYgdGVzdCAteiAiJHsxOi19IjsgdGhlbgogICAgaWYKICAgICAgdGVzdCAiJHtLVUJFRlNfQ0RfU0VTU0lPTjotZmFsc2V9IiA9ICd0cnVlJyAmJgogICAgICB0ZXN0IC1mICIkKEt1YmVGcyBmbiBsb2NrLXNlc3Npb24tZ2V0KSIKICAgIHRoZW4KICAgICAgc2V0IC0tICIkKGRpcm5hbWUgIiQoS3ViZUZzIGZuIGxvY2stc2Vzc2lvbi1nZXQpIikiCiAgICBlbGlmCiAgICAgIHRlc3QgIiR7S1VCRUZTX0NEX1NFU1NJT046LWZhbHNlfSIgPSAndHJ1ZScgJiYKICAgICAgdGVzdCAtZiAiJChLdWJlRnMgZm4gbG9jay1nbG9iYWwtZ2V0KSIKICAgIHRoZW4KICAgICAgc2V0IC0tICIkKGRpcm5hbWUgIiQoS3ViZUZzIGZuIGxvY2stZ2xvYmFsLWdldCkiKSIKICAgIGVsc2UKICAgICAgS3ViZUZzIGdldAogICAgICByZXR1cm4gMAogICAgZmkKICBmaQogICMgaWYgYXJndW1lbnQsIGNkIGlmIC5rdWJlY29uZmlnIGZvdW5kCgogIGlmIHRlc3QgLWYgIiQxLy5rdWJlY29uZmlnIjsgdGhlbgogICAgY29tbWFuZCBjZCAtLSAiJDEiCiAgZWxzZQogICAgS3ViZUZzIGZuIHByaW50Zi1zdGRlcnIgJyMgSU5GTzogbm8gYC5rdWJlY29uZmlnYCBmb3VuZCBpbiBkaXJlY3RvcnkgYCVzYC5cbicgIiQxIgogICAgcmV0dXJuIDAKICBmaQoKICAjIGxvY2sgc2Vzc2lvbiB1bmxlc3MgaXMgYWxyZWFkeSBjdXJyZW50IGxvY2sKICBpZgogICAgdGVzdCAiJHtLVUJFRlNfQ0RfU0VTU0lPTl9MT0NLOi1mYWxzZX0iID0gJ3RydWUnICYmCiAgICB0ZXN0ICIke0xPQ0tfS1VCRUNPTkZJRzotfSIgIT0gIiQxIi8ua3ViZWNvbmZpZwogIHRoZW4KICAgIEt1YmVGcyBmbiBsb2NrLXNlc3Npb24tc2V0ICIkMSIKICBmaQo7OwoKIyBLdWJlRlMgaW50ZXJhY3RpdmUgZnVuY3Rpb25zCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKd2hpY2gpIHNoaWZ0CiAgd2hpbGUgdGVzdCAkIyAtZ3QgMDsgZG8KICAgIGNvbW1hbmQgLXYgIiQxIiA+L2Rldi9udWxsIDI+JjEgfHwgcmV0dXJuICQ/CiAgICBzaGlmdAogIGRvbmUKOzsKCiMjIGNyZWF0ZSBhbiBhbGlhcywgd2l0aCBiYXNoIGNvbXBsZXRpb24KZ2VuLWFsaWFzKSBzaGlmdAogIGFsaWFzICQxPSJLdWJlRnMgJDIiCgogICMga3ViZWZzIGNvbXBsZXRpb24gbm90IHNvdXJjZWQKICBLdWJlRnMgZm4gd2hpY2ggX2t1YmVmc19jb21wbGV0aW9ucyB8fCByZXR1cm4gMAoKICBldmFsICIkKHByaW50ZiAiCiAgX2t1YmVmc19jb21wbGV0aW9uc18kMSgpIHsKICAgIGxvY2FsIGNvbXBsCiAgICBjb21wbD1cJHtDT01QX1dPUkRTW0BdOjF9CiAgICAoKCBDT01QX0NXT1JEICs9IDIgKSkKICAgIENPTVBfV09SRFM9KCBrdWJlY3RsICckMicgXCJcJHtjb21wbDotIH1cIiApCiAgICBfa3ViZWZzX2NvbXBsZXRpb25zCiAgfQogIGNvbXBsZXRlIC1vIG5vc29ydCAtRiBfa3ViZWZzX2NvbXBsZXRpb25zXyQxICQxCiAgIikiCjs7Cgppbml0LXNvdXJjZWQpIHNoaWZ0CiAgIyByZXF1aXJlZAogIGFsaWFzIGt1YmVmcz0nS3ViZUZzJwo7OwoKaW5pdC1pbnRlcmFjdGl2ZSkgc2hpZnQKICAjIGRvIG5vdCBpbmhlcml0IGZyb20gbXV4ZXIgZXRjLgogIHVuc2V0IEtVQkVDT05GSUcgTE9DS19LVUJFQ09ORklHCgogICMgZW5hYmxlIGJhc2ggY29tcGxldGlvbiBmb3Iga3ViZWZzCiAgaWYKICAgIHRlc3QgIiR7S1VCRUZTX0NPTVBMRVRJT046LXRydWV9IiA9ICd0cnVlJyAmJgogICAgS3ViZUZzIGZuIHdoaWNoIF9nZXRfY29tcF93b3Jkc19ieV9yZWYKICB0aGVuCiAgICBldmFsICIkKEt1YmVGcyBmbiBrdWJlZnMtYmFzaC1jb21wbGV0ZSkiCiAgZmkKCiAgIyByZWNvbW1lbmRlZAogIGlmIHRlc3QgIiR7S1VCRUZTX1JFQ09NTUVOREVEX0FMSUFTOi10cnVlfSIgPSAndHJ1ZSc7IHRoZW4KICAgIGFsaWFzIGt1YmVjdGw9J0t1YmVGcyBmbiBrdWJlY3RsJwogICAgYWxpYXMga2Y9J0t1YmVGcycKICAgIEt1YmVGcyBmbiB3aGljaCBfa3ViZWZzX2NvbXBsZXRpb25zICYmIGNvbXBsZXRlIC1vIG5vc29ydCAtRiBfa3ViZWZzX2NvbXBsZXRpb25zIGtmIHx8IDoKICBmaQoKICAjIG9wdGlvbmFsCiAgaWYgdGVzdCAiJHtLVUJFRlNfT1BUSU9OQUxfQUxJQVM6LXRydWV9IiA9ICd0cnVlJzsgdGhlbgogICAgS3ViZUZzIGZuIGdlbi1hbGlhcyBrZmcgJ2xvY2sgZ2xvYmFsIHRvZ2dsZScKICAgIEt1YmVGcyBmbiBnZW4tYWxpYXMga2ZlICdsb2NrIHNlc3Npb24gc2V0JwogICAgS3ViZUZzIGZuIGdlbi1hbGlhcyBrZmwgJ2xvY2sgc2Vzc2lvbiB0b2dnbGUnCiAgICBLdWJlRnMgZm4gZ2VuLWFsaWFzIGtmYyAnY2QnCiAgICBLdWJlRnMgZm4gZ2VuLWFsaWFzIGtmYSAnYXV0aCcKICAgIEt1YmVGcyBmbiBnZW4tYWxpYXMga2ZmICdmaW5kJwogICAgYWxpYXMga2Zscz0nS3ViZUZzIGxpc3QtYWxsJwoKCiAgICAjIHNldCBLVUJFQ09ORklHIGZvciB0b29sCiAgICBmb3IgdG9vbCBpbiAkKHByaW50ZiAnJXNcbicgJHtLVUJFRlNfVE9PTDotdGs6aGVsbX0gfCB0ciAnOicgJyAnKTsgZG8KICAgICAgY29tbWFuZCAtdiAkdG9vbCA+L2Rldi9udWxsIDI+JjEgXAogICAgICAmJiBhbGlhcyAkdG9vbD0iS1VCRUNPTkZJRz1cJChrZikgY29tbWFuZCAkdG9vbCIgfHwgY29udGludWUKICAgIGRvbmUKICBmaQo7OwoKZXNhYwo7OwoKIyMgY29tbWFuZHMKCmN0bHxrdWJlY3RsKQogIHNoaWZ0CiAgS3ViZUZzIGZuIGt1YmVjdGwgIiRAIgo7OwpnfGdldCkKICBwcmludGYgJyVzXG4nICIkKEt1YmVGcyBmbiBmaW5kLWFueS1rdWJlY29uZmlnKSIKOzsKY2R8anVtcCkgc2hpZnQKICBLdWJlRnMgZm4gY2QgIiR7MTotfSIKOzsKbHN8bGlzdCkKICBwcmludGYgJ0tVQkVDT05GSUc9IiVzIlxuJyAiJChLdWJlRnMgZ2V0KSIKOzsKbGF8bHNhfGxpc3QtYWxsKQogIEt1YmVGcyBsaXN0CiAgS3ViZUZzIGxvY2sgc2Vzc2lvbiBsaXN0CiAgS3ViZUZzIGxvY2sgZ2xvYmFsIGxpc3QKOzsKZmluZCkgc2hpZnQKICBjYXNlICR7MTota3ViZWNvbmZpZ30gaW4KICAgIGt1YmVhdXRoKQogICAgICBmaW5kICIke0tVQkVGU19ST09UOi0kSE9NRS8ua3ViZX0iIC10eXBlIGYgLW5hbWUgJy5rdWJlYXV0aCcgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydAogICAgOzsKICAgIGt1YmVjb25maWcpCiAgICAgIGZpbmQgIiR7S1VCRUZTX1JPT1Q6LSRIT01FLy5rdWJlfSIgLXR5cGUgZiAtbmFtZSAnLmt1YmVjb25maWcnIDI+L2Rldi9udWxsIHwgTENfQ09MTEFURT1DLlVURi04IHNvcnQKICAgIDs7CiAgZXNhYwo7OwphdXRofGF1dGhlbnRpY2F0ZSkgc2hpZnQKICBLdWJlRnMgZm4ga3ViZWF1dGggIiR7MTotfSIKOzsKbG9jaykKICBjYXNlICR7Mjotc2Vzc2lvbn0gaW4KICBnbG9iYWwpCiAgICBjYXNlICR7Mzotc2V0fSBpbgogICAgZGVsfGRlbGV0ZXxybXxyZW1vdmV8dW5zZXQpCiAgICAgIEt1YmVGcyBmbiBsb2NrLWdsb2JhbC1kZWwKICAgIDs7CiAgICB0b2dnbGUpCiAgICAgIEt1YmVGcyBmbiBsb2NrLWdsb2JhbC10b2dnbGUgIiR7NDotfSIKICAgIDs7CiAgICBnfGdldCkKICAgICAgS3ViZUZzIGZuIGxvY2stZ2xvYmFsLWdldCBnZXQKICAgIDs7CiAgICBsc3xsaXN0KQogICAgICBLdWJlRnMgZm4gbG9jay1nbG9iYWwtZ2V0IGxpc3QKICAgIDs7CiAgICBzZXR8YWRkfG1rKQogICAgICBLdWJlRnMgZm4gbG9jay1nbG9iYWwtc2V0ICIkezQ6LX0iCiAgICA7OwogICAgZXNhYwogIDs7CgogIHNlc3Npb24pCiAgICBjYXNlICR7Mzotc2V0fSBpbgogICAgZGVsfGRlbGV0ZXxybXxyZW1vdmV8dW5zZXQpCiAgICAgIEt1YmVGcyBmbiBsb2NrLXNlc3Npb24tZGVsCiAgICA7OwogICAgdG9nZ2xlKQogICAgICBLdWJlRnMgZm4gbG9jay1zZXNzaW9uLXRvZ2dsZSAiJHs0Oi19IgogICAgOzsKICAgIGd8Z2V0KQogICAgICBLdWJlRnMgZm4gbG9jay1zZXNzaW9uLWdldCBnZXQKICAgIDs7CiAgICBsc3xsaXN0KQogICAgICBLdWJlRnMgZm4gbG9jay1zZXNzaW9uLWdldCBsaXN0CiAgICA7OwogICAgc2V0fGFkZHxtaykKICAgICAgS3ViZUZzIGZuIGxvY2stc2Vzc2lvbi1zZXQgIiR7NDotfSIKICAgIDs7CiAgICBlc2FjCiAgOzsKICBlc2FjCjs7Cj8qKQogIGNvbW1hbmQgLVYgIl9LdWJlRnNBZGRvbl8kMSIgPi9kZXYvbnVsbCAyPiYxICYmCiAgICBldmFsICJfS3ViZUZzQWRkb25fJDEiIFwiXCRcQFwiIHx8CiAgICBLdWJlRnMgZm4gcHJpbnRmLXN0ZGVyciAnYXJndW1lbnQgYCVzYCBub3Qgc3VwcG9ydGVkXG4nICIkMSIKOzsKaGVscHwqKQpjYXQgPDwgJ0VPRicKTWFuYWdlIG11bHRpcGxlIGt1YmVjb25maWdzIHdpdGggeW91ciBmaWxlc3lzdGVtCgojIFVzYWdlCgprdWJlZnMgIDxjb21tYW5kMT4gW2NvbW1hbmQyXSAuLi4gW2NvbW1hbmROXSBbcGF0aF0KCiMgQXZhaWxhYmxlIGNvbW1hbmRzCgpnZXQKICBwcmludHMgdGhlIGN1cnJlbnQgS1VCRUNPTkZJRwoKY2QgW3BhdGhdCiAgY2QgdG8gYSBkaXJlY3RvcnkgY29udGFpbmluZyBhIC5rdWJlY29uZmlnLCBhbmQgbG9jayBzZXNzaW9uLiBJZiBubyBhcmd1bWVudAogIGlzIGdpdmVuIGl0IHdpbGwgY2QgdG8gdGhlIGN1cnJlbnQgS1VCRUNPTkZJRy4KCmxpc3QKICBwcmludHMgdGhlIGN1cnJlbnQgS1VCRUNPTkZJRyBhcyBhbiBlbnYgdmFyaWFibGUKCmxpc3QtYWxsCiAgc2hvd3Mgc2hlbGwsIHNlc3Npb24gYW5kIGdsb2JhbGx5IGxvY2tlZCBLVUJFQ09ORklHCgphdXRoIFtwYXRoXQogIGV4ZWN1dGVzIGAua3ViZWF1dGhgIGluIHBhdGgsIGlmIHBhdGggbm90IHNwZWNpZmllZCBpdCB3aWxsIHVzZSBjdXJyZW50CiAgd29ya2luZyBkaXJlY3RvcnkKCmxvY2sKICA8Z2xvYmFsL3Nlc3Npb24+CiAgICA8c2V0PiBbcGF0aF0KICAgICAgbG9ja3MgS1VCRUNPTkZJRyB0byBwYXRoCiAgICA8dG9nZ2xlPgogICAgICB0b2dnbGVzIGxvY2sKICAgIDxkZWw+CiAgICAgIGRlbGV0ZSBsb2NrCiAgICA8Z2V0PgogICAgICBwcmludHMgdGhlIGN1cnJlbnQgbG9jayBpZiBhbnkKICAgIDxsaXN0PgogICAgICBwcmludHMgdGhlIGN1cnJlbnQgbG9jayBhcyBhbiBlbnYgdmFyaWFibGUKCiMgQXZhaWxhYmxlIGFyZ3VtZW50cwoKcGF0aCAgYSBmaWxlIG9yIGRpcmVjdG9yeSBkZXBlbmRpbmcgb24gdGhlIGNvbW1hbmQuIElmIGEgZGlyZWN0b3J5IGlzIGdpdmVuLCBhbmQKICAgICAgdGhlIGNvbW1hbmQgZG9lcyBub3QgZmluZCAua3ViZWNvbmZpZyBvciAua3ViZWF1dGgsIGl0IHdpbGwgc2VhcmNoIGZvciB0aGUKICAgICAgZmlyc3Qgb2NjdXJlbmNlIG9mIHRoZSBmaWxlIGluIHRoZSBwYXJlbnQgdHJlZS4KCiMgT3B0aW9ucwoKS1VCRUZTX0NEX1NFU1NJT04gKGRlZmF1bHQ6IGBmYWxzZWApCiAgd2hlbiB1c2luZyBga3ViZWZzIGNkYCB3aXRob3V0IGBwYXRoYCBhcyBhbiBhcmd1bWVudCwgc2V0IHBhdGggdG8gdGhlIHNlc3Npb24KICBsb2NrJ3MgZGlyZWN0b3J5IGlmIHNldCwgaWYgbm90IGF0dGVtcHQgZ2xvYmFsIGxvY2sncyBkaXJlY3RvcnkuCgpLVUJFRlNfQ0RfU0VTU0lPTl9MT0NLIChkZWZhdWx0OiBgZmFsc2VgKQogIHdoZW4gdXNpbmcgYGt1YmVmcyBjZGAgd2l0aCBgcGF0aGAgYXMgYW4gYXJndW1lbnQsIGRvIGEKICBga3ViZWZzIGxvY2sgc2Vzc2lvbiBzZXRgIHRvd2FyZHMgdGhhdCBgcGF0aGAuCgpLVUJFRlNfQVVUSF9TRVNTSU9OX0xPQ0sgKGRlZmF1bHQ6IGBmYWxzZWApCiAgd2hlbiB1c2luZyBga3ViZWZzIGF1dGhgIHdpdGggYHBhdGhgIGFzIGFuIGFyZ3VtZW50LCBkbyBhCiAgYGt1YmVmcyBsb2NrIHNlc3Npb24gc2V0YCB0b3dhcmRzIHRoYXQgYHBhdGhgLgoKS1VCRUZTX0FVVEhfQVVUT19DRCAoZGVmYXVsdDogYGZhbHNlYCkKICB3aGVuIHVzaW5nIGBrdWJlZnMgYXV0aGAgd2l0aCBgcGF0aGAgYXMgYW4gYXJndW1lbnQsIGNkIHRvIHRoYXQgcGF0aC4KCktVQkVGU19SRUNPTU1FTkRFRF9BTElBUyAoZGVmYXVsdDogYHRydWVgKQogIHJlY29tbWVuZGVkIGFsaWFzZXMgdGhhdCBtYWtlcyBzaG9ydCBhbGlhc2VzIG9mIGxvbmcgY29tbWFuZHMuIE9ubHkgdHVybiBvZmYKICBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuCiAgICAtIGBrZmAgLT4gYGt1YmVmc2AKICAgIC0gYGt1YmVmc2AgLT4gYGt1YmVmc2AsIHNldCBgS1VCRUNPTkZJR2AgdG8gYC5rdWJlY29uZmlnYCdzIHBhdGgKCktVQkVGU19PUFRJT05BTF9BTElBUyAoZGVmYXVsdDogYHRydWVgKQogIHJlY29tbWVuZGVkIGFsaWFzZXMgdGhhdCBtYWtlcyBzaG9ydCBhbGlhc2VzIG9mIGxvbmcgY29tbWFuZHMuCiAgICAtIGBrZmdgIGBrdWJlZnMgbG9jayBnbG9iYWwgdG9nZ2xlYAogICAgLSBga2ZlYCBga3ViZWZzIGxvY2sgc2Vzc2lvbiBzZXRgCiAgICAtIGBrZmxgIGBrdWJlZnMgbG9jayBzZXNzaW9uIHRvZ2dsZWAKICAgIC0gYGtmY2AgYGt1YmVmcyBjZGAKICAgIC0gYGtmYWAgYGt1YmVmcyBhdXRoYAogICAgLSBga2Zsc2AgYGt1YmVmcyBsaXN0LWFsbGAKICAgIC0gZm9yIGVhY2ggdG9vbCBpbiBgS1VCRUZTX1RPT0xgIHNldCBgS1VCRUNPTkZJR2AgdG8gYC5rdWJlY29uZmlnYCdzIHBhdGggCgpLVUJFRlNfQkFTRV9BRERPTlMgKGRlZmF1bHQ6IGB0cnVlYCkKICBlbmFibGUgYWxsIGJhc2UgYWRkb25zOgogICAgLSBga3hgIGZvciBsaXN0aW5nIGFuZCBjaGFuZ2luZyBjb250ZXh0CiAgICAtIGBrbmAgZm9yIGxpc3RpbmcgYW5kIGNoYW5naW5nIG5hbWVzcGFjZQogICAgLSBga3ViZWZzIGluaXQgYXV0aGAgY3JlYXRlcyBhIC5rdWJlYXV0aCBpbiBjdXJyZW50IGRpcmVjdG9yeQoKS1VCRUZTX1JPT1QgKGRlZmF1bHQ6IGAkSE9NRS8ua3ViZWApCiAgd2hlcmUgdG8gc2VhcmNoIGZvciAua3ViZWNvbmZpZyBhbmQgLmt1YmVhdXRoLiBSZWNvbW1lbmRlZCB0byBrZWVwIHVuY2hhbmdlZC4KCktVQkVGU19UT09MIChkZWZhdWx0OiBgdGs6aGVsbWApCiAgYSBsaXN0IG9mIHRvb2xzLCBzZXBhcmF0ZWQgYnkgYDpgLiBTZWUgYEtVQkVGU19PUFRJT05BTF9BTElBU2AuCgpLVUJFRlNfQ09NUExFVElPTiAoZGVmYXVsdDogYHRydWVgKQogIGF1dG9tYXRpYyBzb3VyY2luZyBvZiBrdWJlZnMgY29tcGxldGlvbiAoYmFzaCBzaGVsbCkuIERlZmF1bHRzIHRvIGZhbHNlIGlmCiAgYmFzaCBpcyBub3QgdGhlIGN1cnJlbnQgc2hlbGwuCgpLVUJFRlNfREVCVUcgKGRlZmF1bHQ6IGBmYWxzZWApCiAgZW5hYmxlIGRlYnVnZ2luZwoKIyBFeGFtcGxlcwojIyBPcHRpb25zCgpgS1VCRUZTX0NEX1NFU1NJT05gLCBgS1VCRUZTX0NEX1NFU1NJT05fTE9DS2AsIGBLVUJFRlNfQVVUSF9BVVRPX0NEYDogd2hpbGUKYGZhbHNlYCBieSBkZWZhdWx0LCBgdHJ1ZWAgaXMgcmVjb21tZW5kZWQgZm9yIGhlYXZ5IHNoZWxsIHVzZXJzLiBBZGQgdG8geW91cgp+Ly5wcm9maWxlOgoKYGBgCktVQkVGU19DRF9TRVNTSU9OPXRydWUKS1VCRUZTX0NEX1NFU1NJT05fTE9DSz10cnVlCktVQkVGU19BVVRIX0FVVE9fQ0Q9dHJ1ZQpgYGAKCiMgQWJvdXQKIyMgUHJlY2VkZW50Cgpga3ViZWZzYCB3aWxsIHRlbGwgYGt1YmVjdGxgIHRvIHVzZSBhIGNvbmZpZyBmaWxlIGluIHRoZSBmb2xsb3cgb3JkZXI6CgoxLiBsb2NrIHNlc3Npb24gKGBMT0NLX0tVQkVDT05GSUdgKQoyLiBgLmt1YmVjb25maWdgIGluIGN1cnJlbnQgcGF0aCBvciBmaXJzdCBvY2N1cmVuY2UgaW4gdGhlIHBhcmVudCB0cmVlLgozLiBsb2NrIGdsb2JhbCAoYH4va3ViZS9jb25maWdgKQoKIyBOb3RlcwojIyBLVUJFQ09ORklHCgpXaGVuIHVzaW5nL3NvdXJjaW5nIGBrdWJlZnNgIHdpdGggYEtVQkVGU19SRUNPTU1FTkRFRF9BTElBUz10cnVlYCAoZGVmYXVsdCkgeW91CmNhbiBubyBsb25nZXIgc3BlY2lmeSBgS1VCRUNPTkZJR2AsIHVzZSBga3ViZWN0bCAtLWt1YmVjb25maWdgIGluc3RlYWQsIG9yCmRpc2FibGUgYEtVQkVGU19SRUNPTU1FTkRFRF9BTElBUz1mYWxzZWAgYW5kIGB1bmFsaWFzIGt1YmVjdGxgIGluIG9wZW4gc2hlbGxzLgoKRU9GCjs7CmVzYWMKfQoKIyBLVUJFRlMgRU5UUllQT0lOVAojID09PT09PT09PT09PT09PT09CgojIGV4ZWN1dGVkCmlmIHRlc3QgIiQoYmFzZW5hbWUgLS0gIiQwIiAnLnNoJykiID0gJ2t1YmVmcyc7IHRoZW4KICBwcmludGYgLS0gJy0tLQogIFdBUk5JTkc6IGV4ZWN1dGluZyBga3ViZWZzYCBhcyBhbiBleGVjdXRhYmxlIGlzIG5vdCByZWNvbW1lbmRlZC5cbgogIE9ubHkgdGhlIGZvbGxvd2luZyBjb21tYW5kcyBmaWxsIHdvcmsgaW4gdGhpcyBtb2RlOlxuCiAgLSBjdGwKICAtIGdldAogIC0gbHMKICAtIGxzYSwgZXhjZXB0IHNlc3Npb24KICAtIGF1dGgKICAtIGxvY2sgZ2xvYmFsXG4KICBUaGUgcmVjb21tZW5kZWQgd2F5IGlzIHRvIHNvdXJjZSBpdCwgdGhhdCBiZSBpbiB5b3VyIHNoZWxsIG9yIHNjcmlwdC4KICAtLS1cbicgXAogIHwgc2VkIC1FICdzI15cc3syfSMjJyB8IEt1YmVGcyBmbiBwcmludGYtc3RkZXJyCiAgS3ViZUZzICIkQCIKZWxzZQogIEt1YmVGcyBmbiBpbml0LXNvdXJjZWQKICAjIyBpbnRlcmFjdGl2ZSwgbm90IHN1YnNoZWxsZWQsIHdpdGhvdXQgYXJndW1lbnRzCiAgaWYKICAgIGNhc2UgIiR7LTotfSIgaW4gKmkqKSB0cnVlOzsgKikgZmFsc2U7OyBlc2FjICYmCiAgICB0ZXN0IC10IDEgJiYKICAgIHRlc3QgIiR7IzotMH0iIC1lcSAwCiAgdGhlbgogICAgS3ViZUZzIGZuIGluaXQtaW50ZXJhY3RpdmUKICBmaQpmaQoKCg==' | base64 --decode > "$KUBEFS_PROFILE_DIR/kubefs.sh"
printf '%s\n' 'IyEvYmluL3NoCiMgaHR0cHM6Ly9naXRodWIuY29tL2R4bHI4ci9rdWJlZnMKCmlmICIke0tVQkVGU19CQVNFX0FERE9OUzotdHJ1ZX0iID0gJ3RydWUnOyB0aGVuCl9rdWJlZnNfa3ViZWN0bF9hbGlhc19jb21wbGV0ZSgpIHsKICAjIHNraXAgaWYgcmVxdWVzdGVkCiAgdGVzdCAiJHtLVUJFRlNfQ09NUExFVElPTjotdHJ1ZX0iID0gJ3RydWUnIHx8IHJldHVybiAwCiAgIyBub3QgZXhlY3V0ZWQgYXMgYSBzdWJzaGVsbCwgcHJlZml4ZWQgdG8gYSBwaXBlLCBldGMuCiAgdGVzdCAtdCAxIHx8IHJldHVybiAwCiAgIyBiYXNoIGNvbXBsZXRpb24gbm90IHNldHVwCiAgY29tbWFuZCAtdiBfZ2V0X2NvbXBfd29yZHNfYnlfcmVmID4vZGV2L251bGwgMj4mMSB8fCByZXR1cm4gMAogICMga3ViZWN0bCBjb21wbGV0aW9uIG5vdCBzb3VyY2VkCiAgY29tbWFuZCAtdiBfX3N0YXJ0X2t1YmVjdGwgPi9kZXYvbnVsbCAyPiYxIHx8IHJldHVybiAwCgogIGV2YWwgIiQocHJpbnRmICIKICBfa3ViZWN0bF9jb21wbGV0aW9uc18kMSgpIHsKICAgIGxvY2FsIGNvbXBsCiAgICBjb21wbD1cJHtDT01QX1dPUkRTW0BdOjF9CiAgICAoKCBDT01QX0NXT1JEICs9IDIgKSkKICAgIENPTVBfV09SRFM9KCBrdWJlY3RsICQyIFwiXCR7Y29tcGw6LSB9XCIgKQogICAgX19zdGFydF9rdWJlY3RsCiAgfQogIGNvbXBsZXRlIC1vIGRlZmF1bHQgLUYgX2t1YmVjdGxfY29tcGxldGlvbnNfJDEgJDEKICAiKSIKfQoKIyBnZXQgY3VycmVudCBjb250ZXh0IG9yIHNldApfa3ViZWZzX2t1YmVjdGxfYWxpYXNfY29tcGxldGUga3ggJ2NvbmZpZyB1c2UtY29udGV4dCcKa3goKSAoCiAgaWYgY29tbWFuZCAtdiBLdWJlRnMgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICBleHBvcnQgS1VCRUNPTkZJRz0kKEt1YmVGcyBnZXQpCiAgZmkKCiAgIyBzd2l0Y2ggdG8gbmFtZWQgY29udGV4dAogIGlmIHRlc3QgIiQxIjsgdGhlbgogICAga3ViZWN0bCBjb25maWcgdXNlLWNvbnRleHQgIiQxIgogICMgSSBwcm9iYWJseSB3ZW50IG92ZXJib2FyZCBoZXJlIHRvIHJlZm9ybWF0IGBrdWJlY3RsIGNvbmZpZyBnZXQtY29udGV4dHNgCiAgZWxzZQogICAgX3JjdHg9JChrdWJlY3RsIGNvbmZpZyBnZXQtY29udGV4dHMpCiAgICBfaGVhZGVyPSQocHJpbnRmICclc1xuJyAiJF9yY3R4IiB8IGhlYWQgLW4xKQogICAgX21heF9sZW49JChwcmludGYgJyVzXG4nICIkX3JjdHgiIHwgYXdrICd7cHJpbnQgbGVuZ3RofScgfCBzb3J0IC1ybiB8IGhlYWQgLW4xKQogICAgX3NlcD0kJ1x0JwoKICAgICMgQ1VSUkVOVCBOQU1FIENMVVNURVIgQVVUSElORk8gTkFNRVNQQUNFCiAgICBfY29sdW1ucz0ke0tYX0NPTFVNTlM6LSdOQU1FLE5BTUVTUEFDRSxDTFVTVEVSLENVUlJFTlQnfQoKICAgICMgZmlsdGVyIGFuZCBmb3JtYXQgX3JjdHggdG8gX2NvbHVtbnMgdXNpbmcgX3NlcAogICAgX2N0eD0kKHByaW50ZiAnJXNcbicgIiRfcmN0eCIgXAogICAgfCBhd2sgLXYgU0VQPSIkX3NlcCIgLXYgQ09MVU1OUz0iJF9jb2x1bW5zIiBcCiAgICAtdiBIRUFEPSIkX2hlYWRlciIgLXYgTUFYTEVOPSIkX21heF9sZW4iIFwKICAgICdCRUdJTiB7CiAgICAgIHNwbGl0KENPTFVNTlMsIFRDT0wsICIsIikKICAgICAgVENPTF9MRU49MDsgZm9yKENPTCBpbiBUQ09MKXsgVENPTF9MRU4rKyB9CiAgICAgIEdBUD0zOwoKICAgICAgQ1VSUkVOVF9TVEFSVD0wOwogICAgICBDVVJSRU5UX0xFTj1pbmRleChIRUFELCAiTkFNRSIpLTE7CgogICAgICBOQU1FX1NUQVJUPUNVUlJFTlRfTEVOKzE7CiAgICAgIE5BTUVfTEVOPWluZGV4KEhFQUQsICJDTFVTVEVSIiktTkFNRV9TVEFSVDsKCiAgICAgIENMVVNURVJfU1RBUlQ9TkFNRV9TVEFSVCtOQU1FX0xFTgogICAgICBDTFVTVEVSX0xFTj1pbmRleChIRUFELCAiQVVUSElORk8iKS1DTFVTVEVSX1NUQVJUOwoKICAgICAgQVVUSElORk9fU1RBUlQ9Q0xVU1RFUl9TVEFSVCtDTFVTVEVSX0xFTgogICAgICBBVVRISU5GT19MRU49aW5kZXgoSEVBRCwgIk5BTUVTUEFDRSIpLUFVVEhJTkZPX1NUQVJUOwoKICAgICAgTkFNRVNQQUNFX1NUQVJUPUFVVEhJTkZPX1NUQVJUK0FVVEhJTkZPX0xFTgogICAgICBOQU1FU1BBQ0VfTEVOPU1BWExFTi1OQU1FU1BBQ0VfU1RBUlQ7CiAgICB9CiAgICB7CiAgICAgIERDT0xbIkNVUlJFTlQiXT1zdWJzdHIoJDAsIENVUlJFTlRfU1RBUlQsIENVUlJFTlRfTEVOLUdBUCk7CiAgICAgIERDT0xbIk5BTUUiXT1zdWJzdHIoJDAsIE5BTUVfU1RBUlQsIE5BTUVfTEVOLUdBUCk7CiAgICAgIERDT0xbIkNMVVNURVIiXT1zdWJzdHIoJDAsIENMVVNURVJfU1RBUlQsIENMVVNURVJfTEVOLUdBUCk7CiAgICAgIERDT0xbIkFVVEhJTkZPIl09c3Vic3RyKCQwLCBBVVRISU5GT19TVEFSVCwgQVVUSElORk9fTEVOLUdBUCk7CgogICAgICBfTkFNRVNQQUNFPXN1YnN0cigkMCwgTkFNRVNQQUNFX1NUQVJUKTsKICAgICAgZm9yIChpID0gMDsgaSA8PSAoTUFYTEVOLWxlbmd0aCgkMCktMSk7IGkrKykgeyBfTkFNRVNQQUNFPV9OQU1FU1BBQ0UgIiAiIH0KICAgICAgRENPTFsiTkFNRVNQQUNFIl09X05BTUVTUEFDRQoKICAgICAgZm9yKGk9MTsgaSA8PSBUQ09MX0xFTjsgaSsrKSB7CiAgICAgICAgcHJpbnRmICIlcyIsIERDT0xbVENPTFtpXV0KICAgICAgICBpZihpIDwgVENPTF9MRU4pIHsgcHJpbnRmICIlcyIsIFNFUCB9CiAgICAgIH0KICAgICAgcHJpbnRmICJcbiIKICAgIH0nKQoKICAgICMgZmluZCBjb2x1bW4gbnVtYmVyIHdoZXJlIENVUlJFTlQgaXMKICAgIF9jdXJyZW50X2NvbD0kKFwKICAgIHByaW50ZiAnJXMnICIkX2NvbHVtbnMiIFwKICAgIHwgdHIgLCAnXG4nXAogICAgfCBhd2sgJ3tpZigkMSA9PSAiQ1VSUkVOVCIpIHtwcmludCBOUn0gfScpCgogICAgIyBvbmx5IHByaW50IGhlYWRlciAobGluZSAxKSBpZiBub3QgcmVkaXJlY3Rpbmcgc3Rkb3V0CiAgICBpZiB0ZXN0IC10IDE7IHRoZW4KICAgICAgcHJpbnRmICclc1xuJyAiJF9jdHgiIHwgaGVhZCAtbjEKICAgIGZpCiAgICBwcmludGYgJyVzXG4nICIkX2N0eCIgXAogICAgfCBhd2sgJ3tpZihOUiA+IDEpIHtwcmludH19JyBcCiAgICB8IHNvcnQgLXQgIiRfc2VwIiAtayR7X2N1cnJlbnRfY29sfXIKICBmaQopCgojIGdldCBjdXJyZW50IG5hbWVzcGFjZSBvciBzZXQKX2t1YmVmc19rdWJlY3RsX2FsaWFzX2NvbXBsZXRlIGtuICdnZXQgbnMgLS1uby1oZWFkZXJzIC1vIGN1c3RvbS1jb2x1bW5zPSI6Lm1ldGFkYXRhLm5hbWUiJwprbigpICgKICBpZiBjb21tYW5kIC12IEt1YmVGcyA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgIGV4cG9ydCBLVUJFQ09ORklHPSQoS3ViZUZzIGdldCkKICBmaQoKICBpZiB0ZXN0ICIkMSI7IHRoZW4KICAgIGt1YmVjdGwgY29uZmlnIHNldC1jb250ZXh0ICQxCiAgZWxzZQogICAgX2N1cnJlbnQ9JChrdWJlY3RsIGNvbmZpZyB2aWV3IC0tbWluaWZ5IC1vIGpzb25wYXRoPSJ7Li5uYW1lc3BhY2V9IikKICAgIF9hbGw9JChrdWJlY3RsIGdldCBucyAtbyBuYW1lIHwgY3V0IC1kLyAtZjIpCgogICAgX21heF9sZW49JChwcmludGYgJyVzXG4nICIkX2FsbCIgfCBhd2sgJ3twcmludCBsZW5ndGh9JyB8IHNvcnQgLXJuIHwgaGVhZCAtbjEpCiAgICBfc2VwPSQnXHQnCgogICAgX25zPSQocHJpbnRmICclc1xuJyAiJF9hbGwiIFwKICAgIHwgcHJpbnRmICclc1x0JXNcbiVzXG4nICdOQU1FJyAnQ1VSUkVOVCcgIiQoY2F0KSIgXAogICAgfCBhd2sgLXYgQ1VSUkVOVD0iJF9jdXJyZW50IiAtdiBTRVA9IiRfc2VwIiAtdiBNQVhMRU49IiRfbWF4X2xlbiIgJwogICAgewogICAgICBwcmludGYgIiVzIiwgJDEKICAgICAgZm9yKGkgPSAxOyBpIDw9IChNQVhMRU4tbGVuZ3RoKCQxKSk7IGkrKykgewogICAgICAgIHByaW50ZiAiICIKICAgICAgfQogICAgICBwcmludGYgIiVzIixTRVAKICAgICAgaWYoJDEgPT0gQ1VSUkVOVCkgeyBwcmludGYgIiVzIiwgIioiIH0KICAgICAgZWxzZSB7IHByaW50ZiAiJXMiLCAkMiB9CiAgICAgIHByaW50ZiAiXG4iCiAgICB9JykKCiAgICBpZiB0ZXN0IC10IDE7IHRoZW4KICAgICAgcHJpbnRmICclc1xuJyAiJF9ucyIgfCBoZWFkIC1uMQogICAgZmkKICAgIHByaW50ZiAiJXNcbiIgIiRfbnMiIFwKICAgIHwgYXdrICd7aWYoTlIgPiAxKSB7cHJpbnR9fScgXAogICAgfCBzb3J0IC10ICIkX3NlcCIgLWsycgogIGZpCikKCl9LdWJlRnNBZGRvbl9pbml0KCl7CnNoaWZ0CmNhc2UgIiQxIiBpbgphdXRoKSBzaGlmdDsgKAogIGlmIHRlc3QgLWUgIiR7MTotJChwd2QpfS8ua3ViZWF1dGgiOyB0aGVuCiAgICBwcmludGYgJ0VSUk9SOiBgJXNgIGFscmVhZHkgZXhpc3RzLlxuJyAiJHsxOi19Ly5rdWJlYXV0aCIgPiAvZGV2L3N0ZGVycgogICAgcmV0dXJuIDEKICBlbHNlCgoJY2F0IDw8LSAnRU9GJyA+ICIkezE6LSQocHdkKX0vLmt1YmVhdXRoIgoJIyEvYmluL3NoCglzZXQgLWUKCgkjIHNvdXJjZSBrdWJlYXV0aF9pbml0LnNoCgkuICRIT01FLy5sb2NhbC9saWJleGVjL2t1YmVmcy9rdWJlYXV0aC1pbml0LnNoIDI+L2Rldi9udWxsIHx8IFwKCS4gL3Vzci9saWJleGVjL2t1YmVmcy9rdWJlYXV0aC1pbml0LnNoCgoJIyBpZiBhbHJlYWR5IGF0aGVudGljYXRlZCwgZXhpdAoJdGVzdCAtbiAiJHtLVUJFX0FVVEhFTlRJQ0FURUQ6LX0iICYmIGV4aXQgfHwgOgoKCSMgbXlhdXRoX2NtZAoJRU9GCglmaQopCjs7CiopIHNoaWZ0CiAgS3ViZUZzIHByaW50Zi1zdGRlcnIgJ2FyZ3VtZW50IGAlc2Agbm90IHN1cHBvcnRlZFxuJyAiJDEiCjs7CmVzYWMKfQpmaQo=' | base64 --decode > "$KUBEFS_PROFILE_DIR/kubefs-addons.sh"
printf '%s\n' 'IyEvYmluL3NoCiMgaHR0cHM6Ly9naXRodWIuY29tL2R4bHI4ci9rdWJlZnMKIyBoYXZpbmcgYC5rdWJlYXV0aGAgYW5kIGAua3ViZWNvbmZpZ2AgaW4gdGhlIHNhbWUgZGlyZWN0b3J5IGlzIGEgZ29vZCBwcmFjdGljZS4gQnV0IG5vdCByZXF1aXJlZCBieSBrdWJlZnMuCgpFTVBUWV9LVUJFQ09ORklHPSdhcGlWZXJzaW9uOiB2MQpraW5kOiBDb25maWcKY2x1c3RlcnM6IFtdCmNvbnRleHRzOiBbXQpjdXJyZW50LWNvbnRleHQ6ICIiCnVzZXJzOiBbXScKClNQQVRIPSQoQ0RQQVRIPSBjZCAtLSAiJChkaXJuYW1lIC0tICIkMCIpIiAmJiBwd2QpCiMgY2hlY2sgaWYgLmt1YmVjb25maWcgZXhpc3QgaW4gdGhlIHNhbWUgZGlyZWN0b3J5IGFzIGt1YmVhdXRoLWluaXQgaXMgY2FsbGVkL3NvdXJjZWQKaWYgISB0ZXN0IC1mICIke1NQQVRIfS8ua3ViZWNvbmZpZyI7IHRoZW4KICBwcmludGYgJyVzXG4nICIkRU1QVFlfS1VCRUNPTkZJRyIgPiAiJHtTUEFUSH0vLmt1YmVjb25maWciCiAgY2htb2QgNjAwICIke1NQQVRIfS8ua3ViZWNvbmZpZyIKZmkKZXhwb3J0IEtVQkVDT05GSUc9IiR7U1BBVEh9Ly5rdWJlY29uZmlnIgoKdGltZW91dCAxIGt1YmVjdGwgdmVyc2lvbiA+L2Rldi9udWxsIDI+JjEgXAomJiBLVUJFX0FVVEhFTlRJQ0FURUQ9dHJ1ZSBcCnx8IHVuc2V0IEtVQkVfQVVUSEVOVElDQVRFRAo=' | base64 --decode > "$KUBEFS_LIBEXEC_DIR/kubeauth-init.sh"
