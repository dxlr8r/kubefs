#!/bin/sh
# https://github.com/dxlr8r/kubefs
if test ${UID:--1} -eq 0; then
  : ${KUBEFS_LIBEXEC_DIR:="/usr/libexec/kubefs"}
  : ${KUBEFS_PROFILE_DIR:="/etc/profile.d"}
else
  : ${KUBEFS_LIBEXEC_DIR:="$HOME/.local/libexec/kubefs"}
  : ${KUBEFS_PROFILE_DIR:="$HOME/.local/profile.d"}
fi
mkdir -p "$KUBEFS_LIBEXEC_DIR" "$KUBEFS_PROFILE_DIR"
printf '%s\n' 'IyEvYmluL3NoCiMgaHR0cHM6Ly9naXRodWIuY29tL2R4bHI4ci9rdWJlZnMKCmt1YmVmcygpIHsKY2FzZSAiJHsxOi1nZXR9IiBpbgoKIyBrdWJlZnMgZnVuY3Rpb25zCiMgPT09PT09PT09PT09PT09PQoKZm4pIHNoaWZ0CmNhc2UgIiQxIiBpbgprdWJlZnMtYmFzaC1jb21wbGV0ZSkKY2F0IDw8ICdFT0YnCiMga3ViZWZzIGNvbXBsZXRpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLSotIHNoZWxsLXNjcmlwdCAtKi0KCiMgVGhpcyBiYXNoIGNvbXBsZXRpb25zIHNjcmlwdCB3YXMgZ2VuZXJhdGVkIGJ5CiMgY29tcGxldGVseSAoaHR0cHM6Ly9naXRodWIuY29tL2Rhbm55YmVuL2NvbXBsZXRlbHkpCiMgTW9kaWZ5aW5nIGl0IG1hbnVhbGx5IGlzIG5vdCByZWNvbW1lbmRlZAoKX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIoKSB7CiAgbG9jYWwgd29yZHM9IiQxIgogIGxvY2FsIGN1cj0ke0NPTVBfV09SRFNbQ09NUF9DV09SRF19CiAgbG9jYWwgcmVzdWx0PSgpCgogIGlmIFtbICIke2N1cjowOjF9IiA9PSAiLSIgXV07IHRoZW4KICAgIGVjaG8gIiR3b3JkcyIKCiAgZWxzZQogICAgZm9yIHdvcmQgaW4gJHdvcmRzOyBkbwogICAgICBbWyAiJHt3b3JkOjA6MX0iICE9ICItIiBdXSAmJiByZXN1bHQrPSgiJHdvcmQiKQogICAgZG9uZQoKICAgIGVjaG8gIiR7cmVzdWx0WypdfSIKCiAgZmkKfQoKX2t1YmVmc19jb21wbGV0aW9ucygpIHsKICBsb2NhbCBjdXI9JHtDT01QX1dPUkRTW0NPTVBfQ1dPUkRdfQogIGxvY2FsIGNvbXB3b3Jkcz0oIiR7Q09NUF9XT1JEU1tAXToxOiRDT01QX0NXT1JELTF9IikKICBsb2NhbCBjb21wbGluZT0iJHtjb21wd29yZHNbKl19IgoKICBjYXNlICIkY29tcGxpbmUiIGluCiAgICAnbG9jayBzZXNzaW9uIHRvZ2dsZScqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiQoZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWNvbmZpZycgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydCkiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCB0b2dnbGUnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIkKGZpbmQgIiR7S1VCRUZTX1JPT1Q6LSRIT01FLy5rdWJlfSIgLXR5cGUgZiAtbmFtZSAnLmt1YmVjb25maWcnIDI+L2Rldi9udWxsIHwgTENfQ09MTEFURT1DLlVURi04IHNvcnQpIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAnbG9jayBzZXNzaW9uIGxpc3QnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCBsaXN0JyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAiIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAnbG9jayBzZXNzaW9uIHNldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiQoZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWNvbmZpZycgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydCkiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIHNlc3Npb24gZGVsJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAiIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAnbG9jayBzZXNzaW9uIGdldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xvY2sgZ2xvYmFsIHNldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiQoZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWNvbmZpZycgMj4vZGV2L251bGwgfCBMQ19DT0xMQVRFPUMuVVRGLTggc29ydCkiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCBkZWwnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIGdsb2JhbCBnZXQnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsb2NrIHNlc3Npb24nKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICJzZXQgdG9nZ2xlIGRlbCBnZXQgbGlzdCIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xvY2sgZ2xvYmFsJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAic2V0IHRvZ2dsZSBkZWwgZ2V0IGxpc3QiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdsaXN0LWFsbCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xpc3QnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIiKSIgLS0gIiRjdXIiKQogICAgICA7OwoKICAgICdmaW5kJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAia3ViZWF1dGgga3ViZWNvbmZpZyIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2F1dGgnKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICIkKGZpbmQgIiR7S1VCRUZTX1JPT1Q6LSRIT01FLy5rdWJlfSIgLXR5cGUgZiAtbmFtZSAnLmt1YmVhdXRoJyAyPi9kZXYvbnVsbCB8IExDX0NPTExBVEU9Qy5VVEYtOCBzb3J0KSIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2xvY2snKikKICAgICAgd2hpbGUgcmVhZCAtcjsgZG8gQ09NUFJFUExZKz0oIiRSRVBMWSIpOyBkb25lIDwgPChjb21wZ2VuIC1XICIkKF9rdWJlZnNfY29tcGxldGlvbnNfZmlsdGVyICJnbG9iYWwgc2Vzc2lvbiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2dldCcqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgIiIpIiAtLSAiJGN1ciIpCiAgICAgIDs7CgogICAgJ2NkJyopCiAgICAgIHdoaWxlIHJlYWQgLXI7IGRvIENPTVBSRVBMWSs9KCIkUkVQTFkiKTsgZG9uZSA8IDwoY29tcGdlbiAtVyAiJChfa3ViZWZzX2NvbXBsZXRpb25zX2ZpbHRlciAiJChmaW5kICIke0tVQkVGU19ST09UOi0kSE9NRS8ua3ViZX0iIC10eXBlIGYgLW5hbWUgJy5rdWJlY29uZmlnJyAtZXhlYyBkaXJuYW1lIHt9IFw7IDI+L2Rldi9udWxsIHwgTENfQ09MTEFURT1DLlVURi04IHNvcnQpIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgICAqKQogICAgICB3aGlsZSByZWFkIC1yOyBkbyBDT01QUkVQTFkrPSgiJFJFUExZIik7IGRvbmUgPCA8KGNvbXBnZW4gLVcgIiQoX2t1YmVmc19jb21wbGV0aW9uc19maWx0ZXIgImdldCBsaXN0IGxpc3QtYWxsIGZpbmQgY2QgYXV0aCBsb2NrIikiIC0tICIkY3VyIikKICAgICAgOzsKCiAgZXNhYwp9ICYmCiAgY29tcGxldGUgLW8gbm9zb3J0IC1GIF9rdWJlZnNfY29tcGxldGlvbnMga3ViZWZzCgojIGV4OiBmaWxldHlwZT1zaAoKRU9GCjs7CnByaW50Zi1zdGRlcnIpIHNoaWZ0CiAgaWYgdGVzdCAkIyAtZXEgMDsgdGhlbgogICAga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIgJyVzXG4nICIkKGNhdCkiCiAgZWxzZQogICAgcHJpbnRmIC0tICIkQCIgPi9kZXYvc3RkZXJyCiAgZmkKOzsKCmlwcmludGYpIHNoaWZ0CiAgaWYgY2FzZSAiJHstOi19IiBpbiAqaSopIHRydWU7OyAqKSBmYWxzZTs7IGVzYWMgfHwgdGVzdCAiJHtLVUJFRlNfREVCVUc6LWZhbHNlfSIgPSAndHJ1ZSc7IHRoZW4KICAgIGlmIHRlc3QgJCMgLWVxIDA7IHRoZW4KICAgICAgY2F0IHwga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIKICAgIGVsc2UKICAgICAga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIgIiRAIgogICAgZmkKICBmaQo7OwoKZGVidWcpIHNoaWZ0CiAgaWYgdGVzdCAiJHtLVUJFRlNfREVCVUc6LWZhbHNlfSIgPSAndHJ1ZSc7IHRoZW4KICAgIGlmIHRlc3QgJCMgLWVxIDA7IHRoZW4KICAgICAgY2F0IHwga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIKICAgIGVsc2UKICAgICAga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIgIiRAIgogICAgZmkKICBmaQo7OwoKZGVzY2VuZGFudHMpIHNoaWZ0OyAoCiAgdGVzdCAtbiAiJHsxOi19IiB8fCByZXR1cm4gMQogIGlmIHRlc3QgIiQxIiAhPSAnLyc7IHRoZW4KICAgIHByaW50ZiAnJXNcbicgIiQxIgogICAga3ViZWZzIGZuIGRlc2NlbmRhbnRzICIkKGRpcm5hbWUgIiQxIikiCiAgZWxzZQogICAgcHJpbnRmICcvXG4nCiAgICByZXR1cm4gMAogIGZpCikKOzsKCmRpcm5hbWUpIHNoaWZ0OyAoCiAgaWYgdGVzdCAtZCAiJHsxOi19IjsgdGhlbgogICAgIyBwcmludGYgJyVzXG4nICIkMSIKICAgIGNkICIkMSI7IHB3ZAogIGVsaWYgdGVzdCAtZSAiJHsxOi19IjsgdGhlbgogICAgY2QgIiQoZGlybmFtZSAiJDEiKSI7IHB3ZAogIGVsc2UKICAgIDoKICBmaQopCjs7CgpyZXNvbHZlLXN5bWxpbmspIHNoaWZ0CiAgYXdrIFwKICAtdiBMSU5LPSIkMSIgXAogIC12IExJU1Q9IiQoTENfQUxMPUMgY29tbWFuZCBscyAtbCAiJDEiKSIgXAogICdCRUdJTiB7CiAgICBMSU5LX0xFTj1sZW5ndGgoTElOSykKICAgIExJTktfUE9TPWluZGV4KExJU1QsIExJTkspOwogICAgcHJpbnQgc3Vic3RyKExJU1QsIExJTktfUE9TK0xJTktfTEVOKzQpCiAgfScKOzsKCmZpbmQta3ViZWZpbGUpIHNoaWZ0OyAoCiAgc2V0IC0tICIkKGt1YmVmcyBmbiBkaXJuYW1lICIkezE6LX0iKSIgIiR7MjotLmt1YmVjb25maWd9IgogICMgZmluZCBmaXJzdCBvY2N1cmVuY2Ugb2YgLmt1YmVjb25maWcgaW4gdGhlIHBhcmVudCB0cmVlCiAga3ViZWZpbGU9JChcCiAgICBrdWJlZnMgZm4gZGVzY2VuZGFudHMgIiQxIiBcCiAgICB8IHhhcmdzIC1JIHt9IGxzIC0xIHt9LyQyIDI+L2Rldi9udWxsIFwKICAgIHwgaGVhZCAtbjEgXAogICkKICBrdWJlZnMgZm4gZGVidWcgJyMgS1VCRUZJTEU9IiVzIlxuJyAiJGt1YmVmaWxlIgogIHRlc3QgLXogIiRrdWJlZmlsZSIgfHwgcHJpbnRmICclc1xuJyAiJGt1YmVmaWxlIgopCjs7CgpmaW5kLWFueS1rdWJlZmlsZSkgc2hpZnQ7ICgKICBpZgogICAga3ViZWZpbGU9JChrdWJlZnMgZm4gZmluZC1rdWJlZmlsZSAiJHsxOi19IiAiJHsyOi19IikKICAgIHRlc3QgLW4gIiRrdWJlZmlsZSIKICB0aGVuCiAgICA6CiAgZWxpZiB0ZXN0IC1uICIke0xPQ0tfS1VCRUNPTkZJRzotfSI7IHRoZW4KICAgIGt1YmVmaWxlPSIkTE9DS19LVUJFQ09ORklHIgogIGVsc2UKICAgIGt1YmVmaWxlPSIkSE9NRS8ua3ViZS9jb25maWciCiAgZmkKCiAga3ViZWZzIGZuIGRlYnVnICcjIEtVQkVDT05GSUc9IiVzIlxuJyAiJGt1YmVmaWxlIgogIHByaW50ZiAnJXNcbicgIiRrdWJlZmlsZSIKKQo7OwoKbG9jay1zZXNzaW9uLXNldCkgc2hpZnQKICBzZXQgLS0gIiQoa3ViZWZzIGZuIGZpbmQta3ViZWZpbGUgIiR7MTotLn0iKSIKICBpZiB0ZXN0IC16ICIkezE6LX0iOyB0aGVuCiAgICBrdWJlZnMgZm4gcHJpbnRmLXN0ZGVyciAnIyBJTkZPOiBubyBgLmt1YmVjb25maWdgIGZvdW5kIGluIGRpcmVjdG9yeSBgJXNgLlxuJyAiJChwd2QpIgogICAgcmV0dXJuIDEKICBlbHNlCiAgICBleHBvcnQgTE9DS19LVUJFQ09ORklHPSQxCiAgICBleHBvcnQgS1VCRUNPTkZJRz0kTE9DS19LVUJFQ09ORklHCiAgICBrdWJlZnMgZm4gaXByaW50ZiAnIyBMT0NLX0tVQkVDT05GSUc9IiVzIlxuJyAiJExPQ0tfS1VCRUNPTkZJRyIKICBmaQo7Owpsb2NrLXNlc3Npb24tZGVsKSBzaGlmdAogIHRlc3QgIiR7S1VCRUNPTkZJRzotfSIgPSAiJHtMT0NLX0tVQkVDT05GSUc6LX0iICYmIHVuc2V0IEtVQkVDT05GSUcgfHwgOgogIHVuc2V0IExPQ0tfS1VCRUNPTkZJRwogIGt1YmVmcyBmbiBpcHJpbnRmICcjIHVuc2V0IExPQ0tfS1VCRUNPTkZJR1xuJwo7Owpsb2NrLXNlc3Npb24tdG9nZ2xlKSBzaGlmdAogIGlmIHRlc3QgLXogIiR7MTotfSIgLWEgLW4gIiRMT0NLX0tVQkVDT05GSUciOyB0aGVuCiAgICBrdWJlZnMgZm4gbG9jay1zZXNzaW9uLWRlbAogIGVsc2UKICAgIGt1YmVmcyBmbiBsb2NrLXNlc3Npb24tc2V0ICIkezE6LX0iCiAgZmkKOzsKbG9jay1zZXNzaW9uLWdldCkgc2hpZnQ7ICgKICBpZiB0ZXN0IC1uICIkTE9DS19LVUJFQ09ORklHIjsgdGhlbgogICAgdGVzdCAiJHsxOi19IiA9ICJsaXN0IiBcCiAgICAmJiBwcmludGYgJ0xPQ0tfS1VCRUNPTkZJRz0iJXMiXG4nICIkKGt1YmVmcyBmbiBsb2NrLXNlc3Npb24tZ2V0KSIgXAogICAgfHwgcHJpbnRmICclc1xuJyAiJExPQ0tfS1VCRUNPTkZJRyIKICBmaQopCjs7Cgpsb2NrLWdsb2JhbC1zZXQpIHNoaWZ0OyAoCiAgc2V0IC0tICIkKGt1YmVmcyBmbiBmaW5kLWt1YmVmaWxlICIkezE6LS59IikiCiAgaWYgdGVzdCAteiAiJHsxOi19IjsgdGhlbgogICAga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIgJyMgSU5GTzogbm8gYC5rdWJlY29uZmlnYCBmb3VuZCBpbiBkaXJlY3RvcnkgYCVzYC5cbicgIiQocHdkKSIKICAgIHJldHVybiAxCiAgZWxzZQogICAgdGVzdCAtTCAiJEhPTUUvLmt1YmUvY29uZmlnIiAmJiB1bmxpbmsgIiRIT01FLy5rdWJlL2NvbmZpZyIgfHwgOgogICAgaWYgISB0ZXN0IC1lICIkSE9NRS8ua3ViZS9jb25maWciOyB0aGVuCiAgICAgIGxuIC1zICIkMSIgIiRIT01FLy5rdWJlL2NvbmZpZyIKICAgICAga3ViZWZzIGZuIGlwcmludGYgJyMgbG4gLXMgIiVzIiAiJXMiXG4nICIkMSIgIiRIT01FLy5rdWJlL2NvbmZpZyIKICAgIGVsc2UKICAgICAga3ViZWZzIGZuIHByaW50Zi1zdGRlcnIgJyMgRVJST1I6IGAlc2Agbm90IGEgc3ltbGluay5cbicgIiRIT01FLy5rdWJlL2NvbmZpZyIKICAgIGZpCiAgZmkKKQo7Owpsb2NrLWdsb2JhbC1kZWwpIHNoaWZ0OyAoCiAgaWYgdW5saW5rICIkSE9NRS8ua3ViZS9jb25maWciIDI+L2Rldi9udWxsOyB0aGVuCiAgICBrdWJlZnMgZm4gaXByaW50ZiAnIyB1bmxpbmsgIiVzIlxuJyAiJEhPTUUvLmt1YmUvY29uZmlnIgogIGVsc2UKICAgIGt1YmVmcyBmbiBwcmludGYtc3RkZXJyICcjIFdBUk5JTkc6IGAlc2Agbm90IGEgc3ltbGluay5cbicgIiRIT01FLy5rdWJlL2NvbmZpZyIKICBmaQopCjs7CmxvY2stZ2xvYmFsLXRvZ2dsZSkgc2hpZnQ7ICgKICBpZiB0ZXN0IC16ICIkezE6LX0iIC1hIC1MICIkSE9NRS8ua3ViZS9jb25maWciOyB0aGVuCiAgICBrdWJlZnMgZm4gbG9jay1nbG9iYWwtZGVsCiAgZWxzZQogICAga3ViZWZzIGZuIGxvY2stZ2xvYmFsLXNldCAiJHsxOi19IgogIGZpCikKOzsKbG9jay1nbG9iYWwtZ2V0KSBzaGlmdDsgKAogIGlmIHRlc3QgLUwgIiRIT01FLy5rdWJlL2NvbmZpZyI7IHRoZW4KICAgIHRlc3QgIiR7MTotfSIgPSAibGlzdCIgJiYgcHJpbnRmICclcyAtPiAnICIkSE9NRS8ua3ViZS9jb25maWciIHx8IDoKICAgIHByaW50ZiAnJXNcbicgIiQoa3ViZWZzIGZuIHJlc29sdmUtc3ltbGluayAiJEhPTUUvLmt1YmUvY29uZmlnIikiCiAgZmkKKQo7OwoKa3ViZWF1dGgpIHNoaWZ0CiAgaWYgdGVzdCAteiAiJHsxOi19IiAtYSAtbiAiJHtMT0NLX0tVQkVDT05GSUc6LX0iOyB0aGVuCiAgICBrdWJlZnMgZm4gcHJpbnRmLXN0ZGVyciAnIyBJTkZPOiBgTE9DS19LVUJFQ09ORklHYCBpcyBzZXQsIGF0dGVtcHRpbmcgdG8gZGVkdWN0IGAua3ViZWF1dGhgLlxuJwogICAgc2V0IC0tICIkKGt1YmVmcyBmbiBmaW5kLWt1YmVmaWxlICIkTE9DS19LVUJFQ09ORklHIiAnLmt1YmVhdXRoJykiIF8KICBlbHNlCiAgICBzZXQgLS0gIiQoa3ViZWZzIGZuIGZpbmQta3ViZWZpbGUgIiR7MTotLn0iICcua3ViZWF1dGgnKSIKICBmaQoKICBpZiB0ZXN0IC16ICIkMSI7IHRoZW4KICAgIGt1YmVmcyBmbiBwcmludGYtc3RkZXJyICIjIFdBUk5JTkc6IENvdWxkIG5vdCBmaW5kIGFueSBcYC5rdWJlYXV0aFxgIGluIHBhdGggb3IgZGVzY2VuZGFudHMnIHBhdGhzLlxuIgogICAgcmV0dXJuIDEKICBmaQoKICB0ZXN0IC14ICIkMSIgfHwgY2htb2QgK3ggIiQxIgogIGt1YmVmcyBmbiBkZWJ1ZyAnIyBrdWJlYXV0aD0iJXMiXG4nICIkMSIKICAiJDEiCgogICMgbG9jayBzZXNzaW9uIHVubGVzcyBpcyBhbHJlYWR5IGN1cnJlbnQgbG9jawogIGlmCiAgICB0ZXN0ICIke0tVQkVGU19BVVRIX1NFU1NJT05fTE9DSzotZmFsc2V9IiA9ICd0cnVlJyAmJgogICAgdGVzdCAiJHtMT0NLX0tVQkVDT05GSUc6LX0iICE9ICIkMSIvLmt1YmVjb25maWcKICB0aGVuCiAgICBrdWJlZnMgZm4gbG9jay1zZXNzaW9uLXNldCAiJDEiCiAgZmkKCiAgaWYKICAgIHRlc3QgIiR7S1VCRUZTX0FVVEhfQVVUT19DRDotZmFsc2V9IiA9ICd0cnVlJyAmJgogICAgdGVzdCAtbiAiJHsyOi19IgogIHRoZW4KICAgIGt1YmVmcyBmbiBjZCAiJChkaXJuYW1lICIkezE6LX0iKSIKICBmaQoKICAjIGFsbG93IGZvciAua3ViZWF1dGggYW5kIC5rdWJlY29uZmlnIHRvIG5vdCBiZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnksIGJlc2lkZXMgS1VCRUZTX0NEX1NFU1NJT05fTE9DSyBkb2VzIHRoZSBzYW1lCiAgIyB0ZXN0IC16ICIkezI6LX0iIHx8IGt1YmVmcyBmbiBsb2NrLXNlc3Npb24tc2V0ICIkMSIKOzsKCmt1YmVjdGwpIHNoaWZ0OyAoCiAgY2ZnPSQoa3ViZWZzIGZuIGZpbmQta3ViZWZpbGUgIiR7MTotLn0iKQogIHRlc3QgLW4gIiRjZmciICYmIGV4cG9ydCBLVUJFQ09ORklHPSIkY2ZnIiB8fCA6CiAgY29tbWFuZCBrdWJlY3RsICIkQCIKKQo7OwoKY2QpIHNoaWZ0CiAgIyBpZiBubyBhcmd1bWVudCwgc2V0ICQxIHRvIHNlc3Npb24gb3IgZ2xvYmFsIGxvY2sgKGlmIHNldCkKICBpZiB0ZXN0IC16ICIkezE6LX0iOyB0aGVuCiAgICBpZgogICAgICB0ZXN0ICIke0tVQkVGU19DRF9TRVNTSU9OOi1mYWxzZX0iID0gJ3RydWUnICYmCiAgICAgIHRlc3QgLWYgIiQoa3ViZWZzIGZuIGxvY2stc2Vzc2lvbi1nZXQpIgogICAgdGhlbgogICAgICBzZXQgLS0gIiQoZGlybmFtZSAiJChrdWJlZnMgZm4gbG9jay1zZXNzaW9uLWdldCkiKSIKICAgIGVsaWYKICAgICAgdGVzdCAiJHtLVUJFRlNfQ0RfU0VTU0lPTjotZmFsc2V9IiA9ICd0cnVlJyAmJgogICAgICB0ZXN0IC1mICIkKGt1YmVmcyBmbiBsb2NrLWdsb2JhbC1nZXQpIgogICAgdGhlbgogICAgICBzZXQgLS0gIiQoZGlybmFtZSAiJChrdWJlZnMgZm4gbG9jay1nbG9iYWwtZ2V0KSIpIgogICAgZWxzZQogICAgICBrdWJlZnMgZ2V0CiAgICAgIHJldHVybiAwCiAgICBmaQogIGZpCiAgIyBpZiBhcmd1bWVudCwgY2QgaWYgLmt1YmVjb25maWcgZm91bmQKCiAgaWYgdGVzdCAtZiAiJDEvLmt1YmVjb25maWciOyB0aGVuCiAgICBjb21tYW5kIGNkIC0tICIkMSIKICBlbHNlCiAgICBrdWJlZnMgZm4gcHJpbnRmLXN0ZGVyciAnIyBJTkZPOiBubyBgLmt1YmVjb25maWdgIGZvdW5kIGluIGRpcmVjdG9yeSBgJXNgLlxuJyAiJDEiCiAgICByZXR1cm4gMAogIGZpCgogICMgbG9jayBzZXNzaW9uIHVubGVzcyBpcyBhbHJlYWR5IGN1cnJlbnQgbG9jawogIGlmCiAgICB0ZXN0ICIke0tVQkVGU19DRF9TRVNTSU9OX0xPQ0s6LWZhbHNlfSIgPSAndHJ1ZScgJiYKICAgIHRlc3QgIiR7TE9DS19LVUJFQ09ORklHOi19IiAhPSAiJDEiLy5rdWJlY29uZmlnCiAgdGhlbgogICAga3ViZWZzIGZuIGxvY2stc2Vzc2lvbi1zZXQgIiQxIgogIGZpCjs7CgojIGt1YmVmcyBpbnRlcmFjdGl2ZSBmdW5jdGlvbnMKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09Cgp3aGljaCkgc2hpZnQKICB3aGlsZSB0ZXN0ICQjIC1ndCAwOyBkbwogICAgY29tbWFuZCAtdiAiJDEiID4vZGV2L251bGwgMj4mMSB8fCByZXR1cm4gJD8KICAgIHNoaWZ0CiAgZG9uZQo7OwoKIyMgY3JlYXRlIGFuIGFsaWFzLCB3aXRoIGJhc2ggY29tcGxldGlvbgpnZW4tYWxpYXMpIHNoaWZ0CiAgYWxpYXMgJDE9Imt1YmVmcyAkMiIKCiAgIyBrdWJlZnMgY29tcGxldGlvbiBub3Qgc291cmNlZAogIGt1YmVmcyBmbiB3aGljaCBfa3ViZWZzX2NvbXBsZXRpb25zIHx8IHJldHVybiAwCgogIGV2YWwgIiQocHJpbnRmICIKICBfa3ViZWZzX2NvbXBsZXRpb25zXyQxKCkgewogICAgbG9jYWwgY29tcGwKICAgIGNvbXBsPVwke0NPTVBfV09SRFNbQF06MX0KICAgICgoIENPTVBfQ1dPUkQgKz0gMiApKQogICAgQ09NUF9XT1JEUz0oIGt1YmVjdGwgJyQyJyBcIlwke2NvbXBsOi0gfVwiICkKICAgIF9rdWJlZnNfY29tcGxldGlvbnMKICB9CiAgY29tcGxldGUgLW8gbm9zb3J0IC1GIF9rdWJlZnNfY29tcGxldGlvbnNfJDEgJDEKICAiKSIKOzsKCmluaXQtc291cmNlZCkgc2hpZnQKICAjIHJlcXVpcmVkCiAgOgo7OwoKaW5pdC1pbnRlcmFjdGl2ZSkgc2hpZnQKICAjIGRvIG5vdCBpbmhlcml0IGZyb20gbXV4ZXIgZXRjLgogIHVuc2V0IEtVQkVDT05GSUcgTE9DS19LVUJFQ09ORklHCgogICMgZW5hYmxlIGJhc2ggY29tcGxldGlvbiBmb3Iga3ViZWZzCiAgaWYKICAgIHRlc3QgIiR7S1VCRUZTX0NPTVBMRVRJT046LXRydWV9IiA9ICd0cnVlJyAmJgogICAga3ViZWZzIGZuIHdoaWNoIF9nZXRfY29tcF93b3Jkc19ieV9yZWYKICB0aGVuCiAgICBldmFsICIkKGt1YmVmcyBmbiBrdWJlZnMtYmFzaC1jb21wbGV0ZSkiCiAgZmkKCiAgIyByZWNvbW1lbmRlZAogIGlmIHRlc3QgIiR7S1VCRUZTX1JFQ09NTUVOREVEX0FMSUFTOi10cnVlfSIgPSAndHJ1ZSc7IHRoZW4KICAgIGFsaWFzIGt1YmVjdGw9J2t1YmVmcyBmbiBrdWJlY3RsJwogICAgYWxpYXMga2Y9J2t1YmVmcycKICAgIGt1YmVmcyBmbiB3aGljaCBfa3ViZWZzX2NvbXBsZXRpb25zICYmIGNvbXBsZXRlIC1vIG5vc29ydCAtRiBfa3ViZWZzX2NvbXBsZXRpb25zIGtmIHx8IDoKICBmaQoKICAjIG9wdGlvbmFsCiAgaWYgdGVzdCAiJHtLVUJFRlNfT1BUSU9OQUxfQUxJQVM6LXRydWV9IiA9ICd0cnVlJzsgdGhlbgogICAga3ViZWZzIGZuIGdlbi1hbGlhcyBrZmcgJ2xvY2sgZ2xvYmFsIHRvZ2dsZScKICAgIGt1YmVmcyBmbiBnZW4tYWxpYXMga2ZlICdsb2NrIHNlc3Npb24gc2V0JwogICAga3ViZWZzIGZuIGdlbi1hbGlhcyBrZmwgJ2xvY2sgc2Vzc2lvbiB0b2dnbGUnCiAgICBrdWJlZnMgZm4gZ2VuLWFsaWFzIGtmYyAnY2QnCiAgICBrdWJlZnMgZm4gZ2VuLWFsaWFzIGtmYSAnYXV0aCcKICAgIGt1YmVmcyBmbiBnZW4tYWxpYXMga2ZmICdmaW5kJwogICAgYWxpYXMga2Zscz0na3ViZWZzIGxpc3QtYWxsJwoKCiAgICAjIHNldCBLVUJFQ09ORklHIGZvciB0b29sCiAgICBmb3IgdG9vbCBpbiAkKHByaW50ZiAnJXNcbicgJHtLVUJFRlNfVE9PTDotdGs6aGVsbX0gfCB0ciAnOicgJyAnKTsgZG8KICAgICAgY29tbWFuZCAtdiAkdG9vbCA+L2Rldi9udWxsIDI+JjEgXAogICAgICAmJiBhbGlhcyAkdG9vbD0iS1VCRUNPTkZJRz1cJChrZikgY29tbWFuZCAkdG9vbCIgfHwgY29udGludWUKICAgIGRvbmUKICBmaQo7OwoKZXNhYwo7OwoKIyMgY29tbWFuZHMKCmN0bHxrdWJlY3RsKQogIHNoaWZ0CiAga3ViZWZzIGZuIGt1YmVjdGwgIiRAIgo7OwpnfGdldCkKICBwcmludGYgJyVzXG4nICIkKGt1YmVmcyBmbiBmaW5kLWFueS1rdWJlZmlsZSkiCjs7CmNkfGp1bXApIHNoaWZ0CiAga3ViZWZzIGZuIGNkICIkezE6LX0iCjs7CmxzfGxpc3QpCiAgcHJpbnRmICdLVUJFQ09ORklHPSIlcyJcbicgIiQoa3ViZWZzIGdldCkiCjs7CmxhfGxzYXxsaXN0LWFsbCkKICBrdWJlZnMgbGlzdAogIGt1YmVmcyBsb2NrIHNlc3Npb24gbGlzdAogIGt1YmVmcyBsb2NrIGdsb2JhbCBsaXN0Cjs7CmZpbmQpIHNoaWZ0CiAgY2FzZSAkezE6LWt1YmVjb25maWd9IGluCiAgICBrdWJlYXV0aCkKICAgICAgZmluZCAiJHtLVUJFRlNfUk9PVDotJEhPTUUvLmt1YmV9IiAtdHlwZSBmIC1uYW1lICcua3ViZWF1dGgnIDI+L2Rldi9udWxsIHwgTENfQ09MTEFURT1DLlVURi04IHNvcnQKICAgIDs7CiAgICBrdWJlY29uZmlnKQogICAgICBmaW5kICIke0tVQkVGU19ST09UOi0kSE9NRS8ua3ViZX0iIC10eXBlIGYgLW5hbWUgJy5rdWJlY29uZmlnJyAyPi9kZXYvbnVsbCB8IExDX0NPTExBVEU9Qy5VVEYtOCBzb3J0CiAgICA7OwogIGVzYWMKOzsKYXV0aHxhdXRoZW50aWNhdGUpIHNoaWZ0CiAga3ViZWZzIGZuIGt1YmVhdXRoICIkezE6LX0iCjs7CmxvY2spCiAgY2FzZSAkezI6LXNlc3Npb259IGluCiAgZ2xvYmFsKQogICAgY2FzZSAkezM6LXNldH0gaW4KICAgIGRlbHxkZWxldGV8cm18cmVtb3ZlfHVuc2V0KQogICAgICBrdWJlZnMgZm4gbG9jay1nbG9iYWwtZGVsCiAgICA7OwogICAgdG9nZ2xlKQogICAgICBrdWJlZnMgZm4gbG9jay1nbG9iYWwtdG9nZ2xlICIkezQ6LX0iCiAgICA7OwogICAgZ3xnZXQpCiAgICAgIGt1YmVmcyBmbiBsb2NrLWdsb2JhbC1nZXQgZ2V0CiAgICA7OwogICAgbHN8bGlzdCkKICAgICAga3ViZWZzIGZuIGxvY2stZ2xvYmFsLWdldCBsaXN0CiAgICA7OwogICAgc2V0fGFkZHxtaykKICAgICAga3ViZWZzIGZuIGxvY2stZ2xvYmFsLXNldCAiJHs0Oi19IgogICAgOzsKICAgIGVzYWMKICA7OwoKICBzZXNzaW9uKQogICAgY2FzZSAkezM6LXNldH0gaW4KICAgIGRlbHxkZWxldGV8cm18cmVtb3ZlfHVuc2V0KQogICAgICBrdWJlZnMgZm4gbG9jay1zZXNzaW9uLWRlbAogICAgOzsKICAgIHRvZ2dsZSkKICAgICAga3ViZWZzIGZuIGxvY2stc2Vzc2lvbi10b2dnbGUgIiR7NDotfSIKICAgIDs7CiAgICBnfGdldCkKICAgICAga3ViZWZzIGZuIGxvY2stc2Vzc2lvbi1nZXQgZ2V0CiAgICA7OwogICAgbHN8bGlzdCkKICAgICAga3ViZWZzIGZuIGxvY2stc2Vzc2lvbi1nZXQgbGlzdAogICAgOzsKICAgIHNldHxhZGR8bWspCiAgICAgIGt1YmVmcyBmbiBsb2NrLXNlc3Npb24tc2V0ICIkezQ6LX0iCiAgICA7OwogICAgZXNhYwogIDs7CiAgZXNhYwo7Owp1cGRhdGV8dXBncmFkZSkKICBjdXJsIC1MU3EgLS1uby1wcm9ncmVzcy1tZXRlciAtLWZhaWwtd2l0aC1ib2R5IFwKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9keGxyOHIva3ViZWZzL21hc3Rlci9pbnN0YWxsLnNoIHwgc2ggLQo7Owo/KikKICBjb21tYW5kIC1WICJfa3ViZWZzX2FkZG9uXyQxIiA+L2Rldi9udWxsIDI+JjEgJiYKICAgIGV2YWwgIl9rdWJlZnNfYWRkb25fJDEiIFwiXCRcQFwiIHx8CiAgICBrdWJlZnMgZm4gcHJpbnRmLXN0ZGVyciAnYXJndW1lbnQgYCVzYCBub3Qgc3VwcG9ydGVkXG4nICIkMSIKOzsKaGVscHwqKQpjYXQgPDwgJ0VPRicKTWFuYWdlIG11bHRpcGxlIGt1YmVjb25maWdzIHdpdGggeW91ciBmaWxlc3lzdGVtCgojIFVzYWdlCgprdWJlZnMgIDxjb21tYW5kMT4gW2NvbW1hbmQyXSAuLi4gW2NvbW1hbmROXSBbcGF0aF0KCiMgQXZhaWxhYmxlIGNvbW1hbmRzCgpnZXQKICBwcmludHMgdGhlIGN1cnJlbnQgS1VCRUNPTkZJRwoKY2QgW3BhdGhdCiAgY2QgdG8gYSBkaXJlY3RvcnkgY29udGFpbmluZyBhIC5rdWJlY29uZmlnLCBhbmQgbG9jayBzZXNzaW9uLiBJZiBubyBhcmd1bWVudAogIGlzIGdpdmVuIGl0IHdpbGwgY2QgdG8gdGhlIGN1cnJlbnQgS1VCRUNPTkZJRy4KCmxpc3QKICBwcmludHMgdGhlIGN1cnJlbnQgS1VCRUNPTkZJRyBhcyBhbiBlbnYgdmFyaWFibGUKCmxpc3QtYWxsCiAgc2hvd3Mgc2hlbGwsIHNlc3Npb24gYW5kIGdsb2JhbGx5IGxvY2tlZCBLVUJFQ09ORklHCgphdXRoIFtwYXRoXQogIGV4ZWN1dGVzIGAua3ViZWF1dGhgIGluIHBhdGgsIGlmIHBhdGggbm90IHNwZWNpZmllZCBpdCB3aWxsIHVzZSBjdXJyZW50CiAgd29ya2luZyBkaXJlY3RvcnkKCmxvY2sKICA8Z2xvYmFsL3Nlc3Npb24+CiAgICA8c2V0PiBbcGF0aF0KICAgICAgbG9ja3MgS1VCRUNPTkZJRyB0byBwYXRoCiAgICA8dG9nZ2xlPgogICAgICB0b2dnbGVzIGxvY2sKICAgIDxkZWw+CiAgICAgIGRlbGV0ZSBsb2NrCiAgICA8Z2V0PgogICAgICBwcmludHMgdGhlIGN1cnJlbnQgbG9jayBpZiBhbnkKICAgIDxsaXN0PgogICAgICBwcmludHMgdGhlIGN1cnJlbnQgbG9jayBhcyBhbiBlbnYgdmFyaWFibGUKCiMgQXZhaWxhYmxlIGFyZ3VtZW50cwoKcGF0aCAgYSBmaWxlIG9yIGRpcmVjdG9yeSBkZXBlbmRpbmcgb24gdGhlIGNvbW1hbmQuIElmIGEgZGlyZWN0b3J5IGlzIGdpdmVuLCBhbmQKICAgICAgdGhlIGNvbW1hbmQgZG9lcyBub3QgZmluZCAua3ViZWNvbmZpZyBvciAua3ViZWF1dGgsIGl0IHdpbGwgc2VhcmNoIGZvciB0aGUKICAgICAgZmlyc3Qgb2NjdXJlbmNlIG9mIHRoZSBmaWxlIGluIHRoZSBwYXJlbnQgdHJlZS4KCiMgT3B0aW9ucwoKS1VCRUZTX0NEX1NFU1NJT04gKGRlZmF1bHQ6IGBmYWxzZWApCiAgd2hlbiB1c2luZyBga3ViZWZzIGNkYCB3aXRob3V0IGBwYXRoYCBhcyBhbiBhcmd1bWVudCwgc2V0IHBhdGggdG8gdGhlIHNlc3Npb24KICBsb2NrJ3MgZGlyZWN0b3J5IGlmIHNldCwgaWYgbm90IGF0dGVtcHQgZ2xvYmFsIGxvY2sncyBkaXJlY3RvcnkuCgpLVUJFRlNfQ0RfU0VTU0lPTl9MT0NLIChkZWZhdWx0OiBgZmFsc2VgKQogIHdoZW4gdXNpbmcgYGt1YmVmcyBjZGAgd2l0aCBgcGF0aGAgYXMgYW4gYXJndW1lbnQsIGRvIGEKICBga3ViZWZzIGxvY2sgc2Vzc2lvbiBzZXRgIHRvd2FyZHMgdGhhdCBgcGF0aGAuCgpLVUJFRlNfQVVUSF9TRVNTSU9OX0xPQ0sgKGRlZmF1bHQ6IGBmYWxzZWApCiAgd2hlbiB1c2luZyBga3ViZWZzIGF1dGhgIHdpdGggYHBhdGhgIGFzIGFuIGFyZ3VtZW50LCBkbyBhCiAgYGt1YmVmcyBsb2NrIHNlc3Npb24gc2V0YCB0b3dhcmRzIHRoYXQgYHBhdGhgLgoKS1VCRUZTX0FVVEhfQVVUT19DRCAoZGVmYXVsdDogYGZhbHNlYCkKICB3aGVuIHVzaW5nIGBrdWJlZnMgYXV0aGAgd2l0aCBgcGF0aGAgYXMgYW4gYXJndW1lbnQsIGNkIHRvIHRoYXQgcGF0aC4KCktVQkVGU19SRUNPTU1FTkRFRF9BTElBUyAoZGVmYXVsdDogYHRydWVgKQogIHJlY29tbWVuZGVkIGFsaWFzZXMgdGhhdCBtYWtlcyBzaG9ydCBhbGlhc2VzIG9mIGxvbmcgY29tbWFuZHMuIE9ubHkgdHVybiBvZmYKICBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuCiAgICAtIGBrZmAgLT4gYGt1YmVmc2AKICAgIC0gYGt1YmVmc2AgLT4gYGt1YmVmc2AsIHNldCBgS1VCRUNPTkZJR2AgdG8gYC5rdWJlY29uZmlnYCdzIHBhdGgKCktVQkVGU19PUFRJT05BTF9BTElBUyAoZGVmYXVsdDogYHRydWVgKQogIHJlY29tbWVuZGVkIGFsaWFzZXMgdGhhdCBtYWtlcyBzaG9ydCBhbGlhc2VzIG9mIGxvbmcgY29tbWFuZHMuCiAgICAtIGBrZmdgIGBrdWJlZnMgbG9jayBnbG9iYWwgdG9nZ2xlYAogICAgLSBga2ZlYCBga3ViZWZzIGxvY2sgc2Vzc2lvbiBzZXRgCiAgICAtIGBrZmxgIGBrdWJlZnMgbG9jayBzZXNzaW9uIHRvZ2dsZWAKICAgIC0gYGtmY2AgYGt1YmVmcyBjZGAKICAgIC0gYGtmYWAgYGt1YmVmcyBhdXRoYAogICAgLSBga2Zsc2AgYGt1YmVmcyBsaXN0LWFsbGAKICAgIC0gZm9yIGVhY2ggdG9vbCBpbiBgS1VCRUZTX1RPT0xgIHNldCBgS1VCRUNPTkZJR2AgdG8gYC5rdWJlY29uZmlnYCdzIHBhdGggCgpLVUJFRlNfQkFTRV9BRERPTlMgKGRlZmF1bHQ6IGB0cnVlYCkKICBlbmFibGUgYWxsIGJhc2UgYWRkb25zOgogICAgLSBga3hgIGZvciBsaXN0aW5nIGFuZCBjaGFuZ2luZyBjb250ZXh0CiAgICAtIGBrbmAgZm9yIGxpc3RpbmcgYW5kIGNoYW5naW5nIG5hbWVzcGFjZQogICAgLSBga3ViZWZzIGluaXQgYXV0aGAgY3JlYXRlcyBhIC5rdWJlYXV0aCBpbiBjdXJyZW50IGRpcmVjdG9yeQoKS1VCRUZTX1JPT1QgKGRlZmF1bHQ6IGAkSE9NRS8ua3ViZWApCiAgd2hlcmUgdG8gc2VhcmNoIGZvciAua3ViZWNvbmZpZyBhbmQgLmt1YmVhdXRoLiBSZWNvbW1lbmRlZCB0byBrZWVwIHVuY2hhbmdlZC4KCktVQkVGU19UT09MIChkZWZhdWx0OiBgdGs6aGVsbWApCiAgYSBsaXN0IG9mIHRvb2xzLCBzZXBhcmF0ZWQgYnkgYDpgLiBTZWUgYEtVQkVGU19PUFRJT05BTF9BTElBU2AuCgpLVUJFRlNfQ09NUExFVElPTiAoZGVmYXVsdDogYHRydWVgKQogIGF1dG9tYXRpYyBzb3VyY2luZyBvZiBrdWJlZnMgY29tcGxldGlvbiAoYmFzaCBzaGVsbCkuIERlZmF1bHRzIHRvIGZhbHNlIGlmCiAgYmFzaCBpcyBub3QgdGhlIGN1cnJlbnQgc2hlbGwuCgpLVUJFRlNfREVCVUcgKGRlZmF1bHQ6IGBmYWxzZWApCiAgZW5hYmxlIGRlYnVnZ2luZwoKIyBFeGFtcGxlcwojIyBPcHRpb25zCgpgS1VCRUZTX0NEX1NFU1NJT05gLCBgS1VCRUZTX0NEX1NFU1NJT05fTE9DS2AsIGBLVUJFRlNfQVVUSF9TRVNTSU9OX0xPQ0tgOiB3aGlsZQpgZmFsc2VgIGJ5IGRlZmF1bHQsIGB0cnVlYCBpcyByZWNvbW1lbmRlZCBmb3IgaGVhdnkgc2hlbGwgdXNlcnMuIEFkZCB0byB5b3VyCn4vLnByb2ZpbGU6CgpgYGAKS1VCRUZTX0NEX1NFU1NJT049dHJ1ZQpLVUJFRlNfQ0RfU0VTU0lPTl9MT0NLPXRydWUKS1VCRUZTX0FVVEhfU0VTU0lPTl9MT0NLPXRydWUKYGBgCgojIEFib3V0CiMjIFByZWNlZGVudAoKYGt1YmVmc2Agd2lsbCB0ZWxsIGBrdWJlY3RsYCB0byB1c2UgYSBjb25maWcgZmlsZSBpbiB0aGUgZm9sbG93IG9yZGVyOgoKMS4gbG9jayBzZXNzaW9uIChgTE9DS19LVUJFQ09ORklHYCkKMi4gYC5rdWJlY29uZmlnYCBpbiBjdXJyZW50IHBhdGggb3IgZmlyc3Qgb2NjdXJlbmNlIGluIHRoZSBwYXJlbnQgdHJlZS4KMy4gbG9jayBnbG9iYWwgKGB+L2t1YmUvY29uZmlnYCkKCiMgTm90ZXMKIyMgS1VCRUNPTkZJRwoKV2hlbiB1c2luZy9zb3VyY2luZyBga3ViZWZzYCB3aXRoIGBLVUJFRlNfUkVDT01NRU5ERURfQUxJQVM9dHJ1ZWAgKGRlZmF1bHQpIHlvdQpjYW4gbm8gbG9uZ2VyIHNwZWNpZnkgYEtVQkVDT05GSUdgLCB1c2UgYGt1YmVjdGwgLS1rdWJlY29uZmlnYCBpbnN0ZWFkLCBvcgpkaXNhYmxlIGBLVUJFRlNfUkVDT01NRU5ERURfQUxJQVM9ZmFsc2VgIGFuZCBgdW5hbGlhcyBrdWJlY3RsYCBpbiBvcGVuIHNoZWxscy4KCkVPRgo7Owplc2FjCn0KCiMgS1VCRUZTIEVOVFJZUE9JTlQKIyA9PT09PT09PT09PT09PT09PQoKIyBleGVjdXRlZAppZiB0ZXN0ICIkKGJhc2VuYW1lIC0tICIkMCIgJy5zaCcpIiA9ICdrdWJlZnMnOyB0aGVuCiAgcHJpbnRmIC0tICctLS0KICBXQVJOSU5HOiBleGVjdXRpbmcgYGt1YmVmc2AgYXMgYW4gZXhlY3V0YWJsZSBpcyBub3QgcmVjb21tZW5kZWQuXG4KICBPbmx5IHRoZSBmb2xsb3dpbmcgY29tbWFuZHMgZmlsbCB3b3JrIGluIHRoaXMgbW9kZTpcbgogIC0gY3RsCiAgLSBnZXQKICAtIGxzCiAgLSBsc2EsIGV4Y2VwdCBzZXNzaW9uCiAgLSBhdXRoCiAgLSBsb2NrIGdsb2JhbFxuCiAgVGhlIHJlY29tbWVuZGVkIHdheSBpcyB0byBzb3VyY2UgaXQsIHRoYXQgYmUgaW4geW91ciBzaGVsbCBvciBzY3JpcHQuCiAgLS0tXG4nIFwKICB8IHNlZCAtRSAncyNeXHN7Mn0jIycgfCBrdWJlZnMgZm4gcHJpbnRmLXN0ZGVycgogIGt1YmVmcyAiJEAiCmVsc2UKICBrdWJlZnMgZm4gaW5pdC1zb3VyY2VkCiAgIyMgaW50ZXJhY3RpdmUsIG5vdCBzdWJzaGVsbGVkLCB3aXRob3V0IGFyZ3VtZW50cwogIGlmCiAgICBjYXNlICIkey06LX0iIGluICppKikgdHJ1ZTs7ICopIGZhbHNlOzsgZXNhYyAmJgogICAgdGVzdCAtdCAxICYmCiAgICB0ZXN0ICIkeyM6LTB9IiAtZXEgMAogIHRoZW4KICAgIGt1YmVmcyBmbiBpbml0LWludGVyYWN0aXZlCiAgZmkKZmkKCgo=' | base64 --decode > "$KUBEFS_PROFILE_DIR/kubefs.sh"
printf '%s\n' 'IyEvYmluL3NoCiMgaHR0cHM6Ly9naXRodWIuY29tL2R4bHI4ci9rdWJlZnMKCmlmICIke0tVQkVGU19CQVNFX0FERE9OUzotdHJ1ZX0iID0gJ3RydWUnOyB0aGVuCl9rdWJlZnNfa3ViZWN0bF9hbGlhc19jb21wbGV0ZSgpIHsKICAjIHNraXAgaWYgcmVxdWVzdGVkCiAgdGVzdCAiJHtLVUJFRlNfQ09NUExFVElPTjotdHJ1ZX0iID0gJ3RydWUnIHx8IHJldHVybiAwCiAgIyBub3QgZXhlY3V0ZWQgYXMgYSBzdWJzaGVsbCwgcHJlZml4ZWQgdG8gYSBwaXBlLCBldGMuCiAgdGVzdCAtdCAxIHx8IHJldHVybiAwCiAgIyBiYXNoIGNvbXBsZXRpb24gbm90IHNldHVwCiAgY29tbWFuZCAtdiBfZ2V0X2NvbXBfd29yZHNfYnlfcmVmID4vZGV2L251bGwgMj4mMSB8fCByZXR1cm4gMAogICMga3ViZWN0bCBjb21wbGV0aW9uIG5vdCBzb3VyY2VkCiAgY29tbWFuZCAtdiBfX3N0YXJ0X2t1YmVjdGwgPi9kZXYvbnVsbCAyPiYxIHx8IHJldHVybiAwCgogIGV2YWwgIiQocHJpbnRmICIKICBfa3ViZWN0bF9jb21wbGV0aW9uc18kMSgpIHsKICAgIGxvY2FsIGNvbXBsCiAgICBjb21wbD1cJHtDT01QX1dPUkRTW0BdOjF9CiAgICAoKCBDT01QX0NXT1JEICs9IDIgKSkKICAgIENPTVBfV09SRFM9KCBrdWJlY3RsICQyIFwiXCR7Y29tcGw6LSB9XCIgKQogICAgX19zdGFydF9rdWJlY3RsCiAgfQogIGNvbXBsZXRlIC1vIGRlZmF1bHQgLUYgX2t1YmVjdGxfY29tcGxldGlvbnNfJDEgJDEKICAiKSIKfQoKIyBnZXQgY3VycmVudCBjb250ZXh0IG9yIHNldApfa3ViZWZzX2t1YmVjdGxfYWxpYXNfY29tcGxldGUga3ggJ2NvbmZpZyB1c2UtY29udGV4dCcKa3goKSAoCiAgaWYgY29tbWFuZCAtdiBrdWJlZnMgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCiAgICBleHBvcnQgS1VCRUNPTkZJRz0kKGt1YmVmcyBnZXQpCiAgZmkKCiAgIyBzd2l0Y2ggdG8gbmFtZWQgY29udGV4dAogIGlmIHRlc3QgIiQxIjsgdGhlbgogICAga3ViZWN0bCBjb25maWcgdXNlLWNvbnRleHQgIiQxIgogICMgSSBwcm9iYWJseSB3ZW50IG92ZXJib2FyZCBoZXJlIHRvIHJlZm9ybWF0IGBrdWJlY3RsIGNvbmZpZyBnZXQtY29udGV4dHNgCiAgZWxzZQogICAgX3JjdHg9JChrdWJlY3RsIGNvbmZpZyBnZXQtY29udGV4dHMpCiAgICBfaGVhZGVyPSQocHJpbnRmICclc1xuJyAiJF9yY3R4IiB8IGhlYWQgLW4xKQogICAgX21heF9sZW49JChwcmludGYgJyVzXG4nICIkX3JjdHgiIHwgYXdrICd7cHJpbnQgbGVuZ3RofScgfCBzb3J0IC1ybiB8IGhlYWQgLW4xKQogICAgX3NlcD0kJ1x0JwoKICAgICMgQ1VSUkVOVCBOQU1FIENMVVNURVIgQVVUSElORk8gTkFNRVNQQUNFCiAgICBfY29sdW1ucz0ke0tYX0NPTFVNTlM6LSdOQU1FLE5BTUVTUEFDRSxDTFVTVEVSLENVUlJFTlQnfQoKICAgICMgZmlsdGVyIGFuZCBmb3JtYXQgX3JjdHggdG8gX2NvbHVtbnMgdXNpbmcgX3NlcAogICAgX2N0eD0kKHByaW50ZiAnJXNcbicgIiRfcmN0eCIgXAogICAgfCBhd2sgLXYgU0VQPSIkX3NlcCIgLXYgQ09MVU1OUz0iJF9jb2x1bW5zIiBcCiAgICAtdiBIRUFEPSIkX2hlYWRlciIgLXYgTUFYTEVOPSIkX21heF9sZW4iIFwKICAgICdCRUdJTiB7CiAgICAgIHNwbGl0KENPTFVNTlMsIFRDT0wsICIsIikKICAgICAgVENPTF9MRU49MDsgZm9yKENPTCBpbiBUQ09MKXsgVENPTF9MRU4rKyB9CiAgICAgIEdBUD0zOwoKICAgICAgQ1VSUkVOVF9TVEFSVD0wOwogICAgICBDVVJSRU5UX0xFTj1pbmRleChIRUFELCAiTkFNRSIpLTE7CgogICAgICBOQU1FX1NUQVJUPUNVUlJFTlRfTEVOKzE7CiAgICAgIE5BTUVfTEVOPWluZGV4KEhFQUQsICJDTFVTVEVSIiktTkFNRV9TVEFSVDsKCiAgICAgIENMVVNURVJfU1RBUlQ9TkFNRV9TVEFSVCtOQU1FX0xFTgogICAgICBDTFVTVEVSX0xFTj1pbmRleChIRUFELCAiQVVUSElORk8iKS1DTFVTVEVSX1NUQVJUOwoKICAgICAgQVVUSElORk9fU1RBUlQ9Q0xVU1RFUl9TVEFSVCtDTFVTVEVSX0xFTgogICAgICBBVVRISU5GT19MRU49aW5kZXgoSEVBRCwgIk5BTUVTUEFDRSIpLUFVVEhJTkZPX1NUQVJUOwoKICAgICAgTkFNRVNQQUNFX1NUQVJUPUFVVEhJTkZPX1NUQVJUK0FVVEhJTkZPX0xFTgogICAgICBOQU1FU1BBQ0VfTEVOPU1BWExFTi1OQU1FU1BBQ0VfU1RBUlQ7CiAgICB9CiAgICB7CiAgICAgIERDT0xbIkNVUlJFTlQiXT1zdWJzdHIoJDAsIENVUlJFTlRfU1RBUlQsIENVUlJFTlRfTEVOLUdBUCk7CiAgICAgIERDT0xbIk5BTUUiXT1zdWJzdHIoJDAsIE5BTUVfU1RBUlQsIE5BTUVfTEVOLUdBUCk7CiAgICAgIERDT0xbIkNMVVNURVIiXT1zdWJzdHIoJDAsIENMVVNURVJfU1RBUlQsIENMVVNURVJfTEVOLUdBUCk7CiAgICAgIERDT0xbIkFVVEhJTkZPIl09c3Vic3RyKCQwLCBBVVRISU5GT19TVEFSVCwgQVVUSElORk9fTEVOLUdBUCk7CgogICAgICBfTkFNRVNQQUNFPXN1YnN0cigkMCwgTkFNRVNQQUNFX1NUQVJUKTsKICAgICAgZm9yIChpID0gMDsgaSA8PSAoTUFYTEVOLWxlbmd0aCgkMCktMSk7IGkrKykgeyBfTkFNRVNQQUNFPV9OQU1FU1BBQ0UgIiAiIH0KICAgICAgRENPTFsiTkFNRVNQQUNFIl09X05BTUVTUEFDRQoKICAgICAgZm9yKGk9MTsgaSA8PSBUQ09MX0xFTjsgaSsrKSB7CiAgICAgICAgcHJpbnRmICIlcyIsIERDT0xbVENPTFtpXV0KICAgICAgICBpZihpIDwgVENPTF9MRU4pIHsgcHJpbnRmICIlcyIsIFNFUCB9CiAgICAgIH0KICAgICAgcHJpbnRmICJcbiIKICAgIH0nKQoKICAgICMgZmluZCBjb2x1bW4gbnVtYmVyIHdoZXJlIENVUlJFTlQgaXMKICAgIF9jdXJyZW50X2NvbD0kKFwKICAgIHByaW50ZiAnJXMnICIkX2NvbHVtbnMiIFwKICAgIHwgdHIgLCAnXG4nXAogICAgfCBhd2sgJ3tpZigkMSA9PSAiQ1VSUkVOVCIpIHtwcmludCBOUn0gfScpCgogICAgIyBvbmx5IHByaW50IGhlYWRlciAobGluZSAxKSBpZiBub3QgcmVkaXJlY3Rpbmcgc3Rkb3V0CiAgICBpZiB0ZXN0IC10IDE7IHRoZW4KICAgICAgcHJpbnRmICclc1xuJyAiJF9jdHgiIHwgaGVhZCAtbjEKICAgIGZpCiAgICBwcmludGYgJyVzXG4nICIkX2N0eCIgXAogICAgfCBhd2sgJ3tpZihOUiA+IDEpIHtwcmludH19JyBcCiAgICB8IHNvcnQgLXQgIiRfc2VwIiAtayR7X2N1cnJlbnRfY29sfXIKICBmaQopCgojIGdldCBjdXJyZW50IG5hbWVzcGFjZSBvciBzZXQKX2t1YmVmc19rdWJlY3RsX2FsaWFzX2NvbXBsZXRlIGtuICdnZXQgbnMgLS1uby1oZWFkZXJzIC1vIGN1c3RvbS1jb2x1bW5zPSI6Lm1ldGFkYXRhLm5hbWUiJwprbigpICgKICBpZiBjb21tYW5kIC12IGt1YmVmcyA+L2Rldi9udWxsIDI+JjE7IHRoZW4KICAgIGV4cG9ydCBLVUJFQ09ORklHPSQoa3ViZWZzIGdldCkKICBmaQoKICBpZiB0ZXN0ICIkMSI7IHRoZW4KICAgIGt1YmVjdGwgY29uZmlnIHNldC1jb250ZXh0ICQxCiAgZWxzZQogICAgX2N1cnJlbnQ9JChrdWJlY3RsIGNvbmZpZyB2aWV3IC0tbWluaWZ5IC1vIGpzb25wYXRoPSJ7Li5uYW1lc3BhY2V9IikKICAgIF9hbGw9JChrdWJlY3RsIGdldCBucyAtbyBuYW1lIHwgY3V0IC1kLyAtZjIpCgogICAgX21heF9sZW49JChwcmludGYgJyVzXG4nICIkX2FsbCIgfCBhd2sgJ3twcmludCBsZW5ndGh9JyB8IHNvcnQgLXJuIHwgaGVhZCAtbjEpCiAgICBfc2VwPSQnXHQnCgogICAgX25zPSQocHJpbnRmICclc1xuJyAiJF9hbGwiIFwKICAgIHwgcHJpbnRmICclc1x0JXNcbiVzXG4nICdOQU1FJyAnQ1VSUkVOVCcgIiQoY2F0KSIgXAogICAgfCBhd2sgLXYgQ1VSUkVOVD0iJF9jdXJyZW50IiAtdiBTRVA9IiRfc2VwIiAtdiBNQVhMRU49IiRfbWF4X2xlbiIgJwogICAgewogICAgICBwcmludGYgIiVzIiwgJDEKICAgICAgZm9yKGkgPSAxOyBpIDw9IChNQVhMRU4tbGVuZ3RoKCQxKSk7IGkrKykgewogICAgICAgIHByaW50ZiAiICIKICAgICAgfQogICAgICBwcmludGYgIiVzIixTRVAKICAgICAgaWYoJDEgPT0gQ1VSUkVOVCkgeyBwcmludGYgIiVzIiwgIioiIH0KICAgICAgZWxzZSB7IHByaW50ZiAiJXMiLCAkMiB9CiAgICAgIHByaW50ZiAiXG4iCiAgICB9JykKCiAgICBpZiB0ZXN0IC10IDE7IHRoZW4KICAgICAgcHJpbnRmICclc1xuJyAiJF9ucyIgfCBoZWFkIC1uMQogICAgZmkKICAgIHByaW50ZiAiJXNcbiIgIiRfbnMiIFwKICAgIHwgYXdrICd7aWYoTlIgPiAxKSB7cHJpbnR9fScgXAogICAgfCBzb3J0IC10ICIkX3NlcCIgLWsycgogIGZpCikKCl9rdWJlZnNfYWRkb25faW5pdCgpewpzaGlmdApjYXNlICIkMSIgaW4KYXV0aCkgc2hpZnQ7ICgKICBpZiB0ZXN0IC1lICIkezE6LSQocHdkKX0vLmt1YmVhdXRoIjsgdGhlbgogICAgcHJpbnRmICdFUlJPUjogYCVzYCBhbHJlYWR5IGV4aXN0cy5cbicgIiR7MTotfS8ua3ViZWF1dGgiID4gL2Rldi9zdGRlcnIKICAgIHJldHVybiAxCiAgZWxzZQoKCWNhdCA8PC0gJ0VPRicgPiAiJHsxOi0kKHB3ZCl9Ly5rdWJlYXV0aCIKCSMhL2Jpbi9zaAoJc2V0IC1lCgoJIyBzb3VyY2Uga3ViZWF1dGgtYmFzZS5zaAoJLiAke0tVQkVGU19MSUJFWEVDX0RJUjotfi8ubG9jYWwvbGliZXhlYy9rdWJlZnMva3ViZWF1dGgtYmFzZS5zaH0gMj4vZGV2L251bGwgXAogIHx8IC4gL3Vzci9saWJleGVjL2t1YmVmcy9rdWJlYXV0aC1iYXNlLnNoCgoJIyBpZiBhbHJlYWR5IGF0aGVudGljYXRlZCwgZXhpdAoJdGVzdCAtbiAiJHtLVUJFX0FVVEhFTlRJQ0FURUQ6LX0iICYmIGV4aXQgfHwgOgoKCSMgbXlhdXRoX2NtZAoJRU9GCglmaQopCjs7Cj8qKSBzaGlmdAogIGt1YmVmcyBmbiBwcmludGYtc3RkZXJyICdhcmd1bWVudCBgJXNgIG5vdCBzdXBwb3J0ZWRcbicgIiQxIgo7OwoqKSBzaGlmdAogIGt1YmVmcyBmbiBwcmludGYtc3RkZXJyICdhbiBhcmd1bWVudCBoYXMgdG8gYmUgc3BlY2lmaWVkXG4nCjs7CmVzYWMKfQpmaQo=' | base64 --decode > "$KUBEFS_PROFILE_DIR/kubefs-addons.sh"
printf '%s\n' 'IyEvYmluL3NoCiMgaHR0cHM6Ly9naXRodWIuY29tL2R4bHI4ci9rdWJlZnMKIyBoYXZpbmcgYC5rdWJlYXV0aGAgYW5kIGAua3ViZWNvbmZpZ2AgaW4gdGhlIHNhbWUgZGlyZWN0b3J5IGlzIGEgZ29vZCBwcmFjdGljZS4gQnV0IG5vdCByZXF1aXJlZCBieSBrdWJlZnMuCgpFTVBUWV9LVUJFQ09ORklHPSdhcGlWZXJzaW9uOiB2MQpraW5kOiBDb25maWcKY2x1c3RlcnM6IFtdCmNvbnRleHRzOiBbXQpjdXJyZW50LWNvbnRleHQ6ICIiCnVzZXJzOiBbXScKClNQQVRIPSQoQ0RQQVRIPSBjZCAtLSAiJChkaXJuYW1lIC0tICIkMCIpIiAmJiBwd2QpCiMgY2hlY2sgaWYgLmt1YmVjb25maWcgZXhpc3QgaW4gdGhlIHNhbWUgZGlyZWN0b3J5IGFzIGt1YmVhdXRoLWJhc2UgaXMgY2FsbGVkL3NvdXJjZWQKaWYgISB0ZXN0IC1mICIke1NQQVRIfS8ua3ViZWNvbmZpZyI7IHRoZW4KICBwcmludGYgJyVzXG4nICIkRU1QVFlfS1VCRUNPTkZJRyIgPiAiJHtTUEFUSH0vLmt1YmVjb25maWciCiAgY2htb2QgNjAwICIke1NQQVRIfS8ua3ViZWNvbmZpZyIKZmkKZXhwb3J0IEtVQkVDT05GSUc9IiR7U1BBVEh9Ly5rdWJlY29uZmlnIgoKdGltZW91dCAxIGt1YmVjdGwgdmVyc2lvbiA+L2Rldi9udWxsIDI+JjEgXAomJiBLVUJFX0FVVEhFTlRJQ0FURUQ9dHJ1ZSBcCnx8IHVuc2V0IEtVQkVfQVVUSEVOVElDQVRFRAo=' | base64 --decode > "$KUBEFS_LIBEXEC_DIR/kubeauth-base.sh"
